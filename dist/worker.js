var Vr=Object.defineProperty;var _=(t,e)=>()=>(t&&(e=t(t=0)),e);var Re=(t,e)=>{for(var r in e)Vr(t,r,{get:e[r],enumerable:!0})};function we({base:t="",routes:e=[]}={}){return{__proto__:new Proxy({},{get:(r,s,n)=>(i,...o)=>e.push([s.toUpperCase(),RegExp(`^${(t+i).replace(/(\/?)\*/g,"($1.*)?").replace(/(\/$)|((?<=\/)\/)/,"").replace(/:(\w+)(\?)?(\.)?/g,"$2(?<$1>[^/]+)$2$3").replace(/\.(?=[\w(])/,"\\.").replace(/\)\.\?\(([^\[]+)\[\^/g,"?)\\.?($1(?<=\\.)[^\\.")}/*$`),o])&&n}),routes:e,async handle(r,...s){let n,i,o=new URL(r.url);r.query=Object.fromEntries(o.searchParams);for(var[a,c,l]of e)if((a===r.method||a==="ALL")&&(i=o.pathname.match(c))){r.params=i.groups;for(var u of l)if((n=await u(r.proxy||r,...s))!==void 0)return n}}}}var ze=_(()=>{});var x,$,ne=_(()=>{x="https://raw.githubusercontent.com/vanisoul/Myself-BBS-API/refs/heads/main/data/",$=`max-age=${300}, s-maxage=${300}, public`});async function ie(t){if(!Je[t]){let e=await fetch(`${x}details/${t}.json`,{headers:{"Cache-Control":$}});e.status===200&&(Je[t]=await e.json())}return Je[t]}async function Qt(t,e){let r=await fetch(`${x}m3u8/${t}/${e}.m3u8`,{headers:{"Cache-Control":$}});return r.status===200?await r.text():null}var Je,Qe=_(()=>{ne();Je={}});async function j(){if(Xe===null){let t=await fetch(`${x}airing.json`,{headers:{"Cache-Control":$}});t.status===200&&(Xe=await t.json())}return Xe}async function q(){if(Ze===null){let t=await fetch(`${x}completed.json`,{headers:{"Cache-Control":$}});t.status===200&&(Ze=await t.json())}return Ze}var Xe,Ze,Ie=_(()=>{ne();Xe=null,Ze=null});var Xt={};Re(Xt,{response:()=>E});function E({data:t="",status:e=200,headers:r={}}){let s=new Headers;s.append("Content-Type","application/json; charset=utf-8"),s.append("Access-Control-Allow-Origin","*"),s.append("Access-Control-Allow-Headers","*"),s.append("Access-Control-Allow-Methods","*"),s.append("Access-Control-Allow-Credentials","true"),s.append("Cache-Control",$),s.append("Cross-Origin-Resource-Policy","cross-origin");for(let n of Object.keys(r))s.append(n,r[n]);return new Response(t,{status:e,headers:s})}var oe=_(()=>{ne()});function ce(t,e="\u53C3\u6578\u7121\u6548"){return new A(f.INVALID_PARAMETER,`\u53C3\u6578\u932F\u8AA4\uFF1A${t} ${e}`,{parameter:t,reason:e})}function dr(t){return new A(f.MISSING_PARAMETER,`\u7F3A\u5C11\u5FC5\u8981\u53C3\u6578\uFF1A${t}`,{parameter:t})}function W(t,e){return new A(f.DATA_NOT_FOUND,`\u8CC7\u6599\u4E0D\u5B58\u5728\uFF1A\u627E\u4E0D\u5230 ${t} (ID: ${e})`,{resource:t,id:e})}function K(t,e=null){return new A(f.INTERNAL_ERROR,`\u7CFB\u7D71\u932F\u8AA4\uFF1A${t}`,{originalError:e?.message})}function gt(t,e=null){return new A(f.NETWORK_ERROR,`\u7DB2\u8DEF\u932F\u8AA4\uFF1A${t}`,{originalError:e?.message})}function hr(t,e={}){return new A(f.DATA_CONVERSION_FAILED,`\u8CC7\u6599\u8F49\u63DB\u5931\u6557\uFF1A${t}`,{data:e})}function X(t){return t instanceof A?t:t instanceof TypeError?ce("type",t.message):t instanceof RangeError?new A(f.PARAMETER_OUT_OF_RANGE,`\u53C3\u6578\u8D85\u51FA\u7BC4\u570D\uFF1A${t.message}`,{originalError:t.message}):t.name==="NetworkError"||t.code==="NETWORK_ERROR"?gt(t.message,t):t.name==="TimeoutError"||t.code==="TIMEOUT"?new A(f.TIMEOUT_ERROR,`\u8ACB\u6C42\u903E\u6642\uFF1A${t.message}`,{originalError:t.message}):K(t.message,t)}function pr(t,e="zh-TW"){return Te[e]?.[t]||Te["zh-TW"][t]||"\u672A\u77E5\u932F\u8AA4"}var f,mt,A,Te,Se=_(()=>{f={MISSING_PARAMETER:"MISSING_PARAMETER",INVALID_PARAMETER:"INVALID_PARAMETER",PARAMETER_OUT_OF_RANGE:"PARAMETER_OUT_OF_RANGE",DATA_NOT_FOUND:"DATA_NOT_FOUND",DATA_CORRUPTED:"DATA_CORRUPTED",DATA_CONVERSION_FAILED:"DATA_CONVERSION_FAILED",NETWORK_ERROR:"NETWORK_ERROR",TIMEOUT_ERROR:"TIMEOUT_ERROR",INTERNAL_ERROR:"INTERNAL_ERROR",INVALID_OPERATION:"INVALID_OPERATION",RESOURCE_LIMIT_EXCEEDED:"RESOURCE_LIMIT_EXCEEDED"},mt={[f.MISSING_PARAMETER]:-1,[f.INVALID_PARAMETER]:-1,[f.PARAMETER_OUT_OF_RANGE]:-1,[f.DATA_NOT_FOUND]:-2,[f.NETWORK_ERROR]:0,[f.TIMEOUT_ERROR]:0,[f.INTERNAL_ERROR]:0,[f.DATA_CORRUPTED]:0,[f.DATA_CONVERSION_FAILED]:0,[f.INVALID_OPERATION]:0,[f.RESOURCE_LIMIT_EXCEEDED]:0},A=class extends Error{constructor(e,r,s={}){super(r),this.name="Cms10Error",this.type=e,this.details=s,this.timestamp=new Date().toISOString()}getCms10Code(){return mt[this.type]||0}toCms10Response(){return{code:this.getCms10Code(),msg:this.message,page:1,pagecount:0,limit:"20",total:0,list:[]}}};Te={"zh-TW":{[f.MISSING_PARAMETER]:"\u7F3A\u5C11\u5FC5\u8981\u53C3\u6578",[f.INVALID_PARAMETER]:"\u53C3\u6578\u683C\u5F0F\u932F\u8AA4",[f.PARAMETER_OUT_OF_RANGE]:"\u53C3\u6578\u8D85\u51FA\u7BC4\u570D",[f.DATA_NOT_FOUND]:"\u627E\u4E0D\u5230\u6307\u5B9A\u7684\u8CC7\u6599",[f.DATA_CORRUPTED]:"\u8CC7\u6599\u5DF2\u640D\u58DE",[f.DATA_CONVERSION_FAILED]:"\u8CC7\u6599\u8F49\u63DB\u5931\u6557",[f.NETWORK_ERROR]:"\u7DB2\u8DEF\u9023\u7DDA\u932F\u8AA4",[f.INTERNAL_ERROR]:"\u7CFB\u7D71\u5167\u90E8\u932F\u8AA4",[f.TIMEOUT_ERROR]:"\u8ACB\u6C42\u903E\u6642",[f.INVALID_OPERATION]:"\u7121\u6548\u7684\u64CD\u4F5C",[f.RESOURCE_LIMIT_EXCEEDED]:"\u8CC7\u6E90\u9650\u5236\u8D85\u51FA"},en:{[f.MISSING_PARAMETER]:"Missing required parameter",[f.INVALID_PARAMETER]:"Invalid parameter format",[f.PARAMETER_OUT_OF_RANGE]:"Parameter out of range",[f.DATA_NOT_FOUND]:"Data not found",[f.DATA_CORRUPTED]:"Data corrupted",[f.DATA_CONVERSION_FAILED]:"Data conversion failed",[f.NETWORK_ERROR]:"Network connection error",[f.INTERNAL_ERROR]:"Internal server error",[f.TIMEOUT_ERROR]:"Request timeout",[f.INVALID_OPERATION]:"Invalid operation",[f.RESOURCE_LIMIT_EXCEEDED]:"Resource limit exceeded"}}});function U(t){return async e=>{let r=Date.now();try{let s=await t(e),n=Date.now()-r;return n>1e3&&G.logPerformance(t.name||"anonymous",n,{url:e.url,success:!0}),s}catch(s){let n=Date.now()-r,i=yt(e);if(G.log(s,i),G.logPerformance(t.name||"anonymous",n,{url:e.url,success:!1,errorType:s.type||s.name}),s instanceof A)return be.record(s.type,{url:i.url,parameter:s.details?.parameter}),E({data:JSON.stringify(s.toCms10Response(),null,2)});let o=X(s);return be.record(o.type,{url:i.url,originalError:s.name}),E({data:JSON.stringify(o.toCms10Response(),null,2)})}}}function yt(t){let e=new URL(t.url);return{url:e.pathname+e.search,method:t.method,query:Object.fromEntries(e.searchParams),userAgent:t.headers.get("User-Agent")||"Unknown",ip:t.headers.get("CF-Connecting-IP")||t.headers.get("X-Forwarded-For")||t.headers.get("X-Real-IP")||"Unknown"}}function fr(t,e=!1){return t.toCms10Response()}async function mr(t,e=3,r=1e3){let s;for(let n=0;n<=e;n++)try{return await t()}catch(i){s=i,n<e&&(console.warn(`\u91CD\u8A66 ${n+1}/${e}:`,i.message),await new Promise(o=>setTimeout(o,r*Math.pow(2,n))))}throw X(s)}async function gr(t,e){try{return await t()}catch(r){console.warn("\u4E3B\u8981\u8655\u7406\u5931\u6557\uFF0C\u4F7F\u7528\u964D\u7D1A\u65B9\u6848:",r.message);try{return await e()}catch(s){throw X(s)}}}function yr(t=100,e=6e4){let r=new Map;return s=>{let n=s.headers.get("CF-Connecting-IP")||s.headers.get("X-Forwarded-For")||"unknown",i=Date.now(),o=i-e;if(r.has(n)){let c=r.get(n).filter(l=>l>o);r.set(n,c)}else r.set(n,[]);let a=r.get(n);if(a.length>=t)throw new A("RESOURCE_LIMIT_EXCEEDED","\u8ACB\u6C42\u983B\u7387\u904E\u9AD8\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66",{ip:n,requestCount:a.length,windowMs:e});a.push(i)}}var G,le,be,Et=_(()=>{oe();Se();G=class{static log(e,r={}){let s={timestamp:new Date().toISOString(),error:{name:e.name,message:e.message,type:e.type||"UNKNOWN",stack:e.stack},context:{url:r.url,method:r.method,query:r.query,userAgent:r.userAgent,ip:r.ip}};e instanceof A&&e.getCms10Code()===-1?console.warn("\u53C3\u6578\u932F\u8AA4:",JSON.stringify(s,null,2)):e instanceof A&&e.getCms10Code()===-2?console.info("\u8CC7\u6599\u4E0D\u5B58\u5728:",JSON.stringify(s,null,2)):console.error("\u7CFB\u7D71\u932F\u8AA4:",JSON.stringify(s,null,2))}static logPerformance(e,r,s={}){let n={timestamp:new Date().toISOString(),type:"PERFORMANCE",operation:e,duration:r,metadata:s};r>5e3?console.warn("\u6548\u80FD\u8B66\u544A:",JSON.stringify(n,null,2)):r>1e3&&console.info("\u6548\u80FD\u8CC7\u8A0A:",JSON.stringify(n,null,2))}},le=class{constructor(){this.stats=new Map,this.startTime=Date.now()}record(e,r={}){let s=this.stats.get(e)||{count:0,lastOccurred:null,metadata:[]};s.count++,s.lastOccurred=new Date().toISOString(),s.metadata.push({timestamp:new Date().toISOString(),...r}),s.metadata.length>100&&(s.metadata=s.metadata.slice(-100)),this.stats.set(e,s)}getStats(){let e={};for(let[r,s]of this.stats)e[r]={count:s.count,lastOccurred:s.lastOccurred,recentMetadata:s.metadata.slice(-10)};return e._summary={totalErrors:Array.from(this.stats.values()).reduce((r,s)=>r+s.count,0),uniqueErrorTypes:this.stats.size,uptime:Date.now()-this.startTime},e}reset(){this.stats.clear(),this.startTime=Date.now()}getErrorRate(e){let r=Array.from(this.stats.values()).reduce((s,n)=>s+n.count,0);return e>0?r/e:0}},be=new le});var Ar={};Re(Ar,{EPISODE_FORMATS:()=>d,clearFormatDetectionCache:()=>ws,detectEpisodesFormat:()=>_t,detectEpisodesFormatCached:()=>Pe,getFormatDetectionCacheStats:()=>Is,getFormatDetectionReport:()=>_s,validateEpisodesData:()=>Me});function As(t){if(!t||typeof t!="string")return d.UNKNOWN;let e=t.trim();return Er.PLAY_PATH.test(e)?d.PLAY_PATH:Er.ENCODED_ID.test(e)&&e.length>=10&&e.length<=30?d.ENCODED_ID:d.UNKNOWN}function _t(t){if(!t||typeof t!="object")return{format:d.UNKNOWN,confidence:0,details:{error:"Episodes \u8CC7\u6599\u7121\u6548\u6216\u70BA\u7A7A",totalEpisodes:0,validEpisodes:0,formatCounts:{}}};let e=Object.entries(t);if(e.length===0)return{format:d.UNKNOWN,confidence:0,details:{error:"Episodes \u8CC7\u6599\u70BA\u7A7A",totalEpisodes:0,validEpisodes:0,formatCounts:{}}};let r={[d.PLAY_PATH]:0,[d.ENCODED_ID]:0,[d.UNKNOWN]:0},s=[];for(let[c,l]of e){let u=As(l);r[u]++,s.push({name:c,value:l,format:u})}let n=e.length,i=n-r[d.UNKNOWN],o=d.UNKNOWN,a=0;return r[d.PLAY_PATH]>0&&r[d.ENCODED_ID]===0?(o=d.PLAY_PATH,a=r[d.PLAY_PATH]/n):r[d.ENCODED_ID]>0&&r[d.PLAY_PATH]===0&&(o=d.ENCODED_ID,a=r[d.ENCODED_ID]/n),{format:o,confidence:a,details:{totalEpisodes:n,validEpisodes:i,formatCounts:r,detectionResults:s,isMixed:r[d.PLAY_PATH]>0&&r[d.ENCODED_ID]>0,hasUnknown:r[d.UNKNOWN]>0}}}function Me(t){let e=[],r=[];if(!t)return e.push("Episodes \u8CC7\u6599\u70BA null \u6216 undefined"),{isValid:!1,errors:e,warnings:r};if(typeof t!="object")return e.push("Episodes \u8CC7\u6599\u5FC5\u9808\u70BA\u7269\u4EF6\u985E\u578B"),{isValid:!1,errors:e,warnings:r};if(Array.isArray(t))return e.push("Episodes \u8CC7\u6599\u4E0D\u80FD\u70BA\u9663\u5217"),{isValid:!1,errors:e,warnings:r};let s=Object.entries(t);s.length===0&&r.push("Episodes \u8CC7\u6599\u70BA\u7A7A");for(let[n,i]of s)(!n||typeof n!="string")&&e.push(`\u7121\u6548\u7684 episode \u540D\u7A31: ${n}`),(!i||typeof i!="string")&&e.push(`\u7121\u6548\u7684 episode \u503C: ${i} (\u540D\u7A31: ${n})`),n&&n.trim().length===0&&r.push(`Episode \u540D\u7A31\u70BA\u7A7A\u5B57\u4E32: "${n}"`),i&&i.trim().length===0&&r.push(`Episode \u503C\u70BA\u7A7A\u5B57\u4E32: "${i}" (\u540D\u7A31: ${n})`);return{isValid:e.length===0,errors:e,warnings:r}}function _s(t){let e=Me(t),r=_t(t);return{timestamp:new Date().toISOString(),validation:e,detection:r,summary:{isValid:e.isValid,format:r.format,confidence:r.confidence,totalEpisodes:r.details.totalEpisodes,validEpisodes:r.details.validEpisodes,hasIssues:e.errors.length>0||e.warnings.length>0,isMixed:r.details.isMixed},recommendations:Rs(e,r)}}function Rs(t,e){let r=[];return t.isValid||r.push({type:"error",message:"\u8ACB\u4FEE\u6B63 episodes \u8CC7\u6599\u683C\u5F0F\u932F\u8AA4",details:t.errors}),t.warnings.length>0&&r.push({type:"warning",message:"\u5EFA\u8B70\u6AA2\u67E5 episodes \u8CC7\u6599\u54C1\u8CEA",details:t.warnings}),e.confidence<.8&&r.push({type:"warning",message:`\u683C\u5F0F\u6AA2\u6E2C\u4FE1\u5FC3\u5EA6\u8F03\u4F4E (${(e.confidence*100).toFixed(1)}%)\uFF0C\u5EFA\u8B70\u6AA2\u67E5\u8CC7\u6599\u4E00\u81F4\u6027`}),e.details.isMixed&&r.push({type:"info",message:"\u6AA2\u6E2C\u5230\u6DF7\u5408\u683C\u5F0F\uFF0C\u5C07\u4F7F\u7528\u4E3B\u8981\u683C\u5F0F\u9032\u884C\u8655\u7406",details:`\u4E3B\u8981\u683C\u5F0F: ${e.format}`}),e.details.hasUnknown&&r.push({type:"warning",message:`\u767C\u73FE ${e.details.formatCounts[d.UNKNOWN]} \u500B\u7121\u6CD5\u8B58\u5225\u7684\u683C\u5F0F`,details:"\u9019\u4E9B episodes \u53EF\u80FD\u7121\u6CD5\u6B63\u78BA\u8655\u7406"}),r}function Pe(t){let e=ue.get(t);if(e)return{...e,fromCache:!0};let r=_t(t);return ue.set(t,r),{...r,fromCache:!1}}function ws(){ue.clear()}function Is(){return{size:ue.size(),maxSize:ue.maxSize}}var d,Er,At,ue,de=_(()=>{d={PLAY_PATH:"play_path",ENCODED_ID:"encoded_id",UNKNOWN:"unknown"},Er={PLAY_PATH:/^play\/\d+\/\d+$/,ENCODED_ID:/^[A-Za-z0-9_-]+$/};At=class{constructor(e=100){this.cache=new Map,this.maxSize=e}generateKey(e){let s=Object.entries(e||{}).sort(([n],[i])=>n.localeCompare(i));return JSON.stringify(s)}get(e){let r=this.generateKey(e);if(this.cache.has(r)){let s=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,s),s}return null}set(e,r){let s=this.generateKey(e);if(this.cache.size>=this.maxSize){let n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(s,r)}clear(){this.cache.clear()}size(){return this.cache.size}},ue=new At});function wt(t,e={}){if(!t||typeof t!="string")throw new Error("Play path \u4E0D\u80FD\u70BA\u7A7A\u4E14\u5FC5\u9808\u70BA\u5B57\u4E32");let r=t.trim();if(!r.startsWith("play/"))throw new Error(`\u7121\u6548\u7684 play path \u683C\u5F0F: ${r}`);let s=r.substring(5);if(!/^\d+\/\d+$/.test(s))throw new Error(`\u7121\u6548\u7684 play path \u683C\u5F0F: ${r}\uFF0C\u61C9\u8A72\u70BA play/\u6578\u5B57/\u6578\u5B57`);let n={...he,...e};return Object.values(M).includes(n.quality)||(console.warn(`\u4E0D\u652F\u63F4\u7684\u5F71\u7247\u54C1\u8CEA: ${n.quality}\uFF0C\u4F7F\u7528\u9810\u8A2D\u54C1\u8CEA: ${he.quality}`),n.quality=he.quality),_r.VPX.replace("{path}",s).replace("{quality}",n.quality)}function It(t,e={}){if(!t||typeof t!="string")throw new Error("Encoded ID \u4E0D\u80FD\u70BA\u7A7A\u4E14\u5FC5\u9808\u70BA\u5B57\u4E32");let r=t.trim();if(!/^[A-Za-z0-9_-]+$/.test(r))throw new Error(`\u7121\u6548\u7684\u7DE8\u78BC ID \u683C\u5F0F: ${r}`);if(r.length<10)throw new Error(`\u7DE8\u78BC ID \u9577\u5EA6\u592A\u77ED: ${r}\uFF0C\u6700\u5C11\u9700\u8981 10 \u500B\u5B57\u7B26`);let s={...he,...e},n=Ns(r);return _r.HLS.replace("{segments}",n)}function Ns(t){if(t.length<10)throw new Error(`\u7DE8\u78BC ID \u9577\u5EA6\u4E0D\u8DB3\uFF0C\u7121\u6CD5\u5206\u5272: ${t}`);let e=t.substring(4,6),r=t.substring(6,8),s=t.substring(8,10);if(!e||!r||!s)throw new Error(`\u7DE8\u78BC ID \u5206\u5272\u5931\u6557: ${t}`);return`${e}/${r}/${s}/${t}`}function Os(t){switch(t){case d.PLAY_PATH:return wt;case d.ENCODED_ID:return It;default:throw new Error(`\u4E0D\u652F\u63F4\u7684\u683C\u5F0F\u985E\u578B: ${t}`)}}function Rr(t,e,r={}){if(!t||typeof t!="object")throw new Error("Episodes \u8CC7\u6599\u7121\u6548");let s=Os(e),n=[];for(let[i,o]of Object.entries(t))try{let a=s(o,r);n.push({name:i,value:o,url:a,success:!0,error:null})}catch(a){console.warn(`\u751F\u6210 URL \u5931\u6557 (${i}):`,a.message),n.push({name:i,value:o,url:null,success:!1,error:a.message})}return n}function wr(t,e,r){let s=t.match(/(\d+)/),n=s?s[1].padStart(3,"0"):"001";return`${he.baseUrl}/m3u8/${r}/${n}`}var _r,M,he,Rt,Xs,Nt=_(()=>{de();_r={VPX:"https://vpx05.myself-bbs.com/vpx/{path}/{quality}.m3u8",HLS:"https://vpx05.myself-bbs.com/hls/{segments}/index.m3u8"},M={HD720:"720p",HD1080:"1080p",SD480:"480p"},he={quality:M.HD720,baseUrl:"https://vpx05.myself-bbs.com",timeout:5e3};Rt=class{constructor(){this.stats={total:0,successful:0,failed:0,byFormat:{[d.PLAY_PATH]:{total:0,successful:0,failed:0},[d.ENCODED_ID]:{total:0,successful:0,failed:0}},errors:[]}}record(e,r,s=null){this.stats.total++,this.stats.byFormat[e].total++,r?(this.stats.successful++,this.stats.byFormat[e].successful++):(this.stats.failed++,this.stats.byFormat[e].failed++,s&&this.stats.errors.push({timestamp:new Date().toISOString(),format:e,error:s.toString()}))}getStats(){return{...this.stats,successRate:this.stats.total>0?this.stats.successful/this.stats.total:0,byFormat:Object.fromEntries(Object.entries(this.stats.byFormat).map(([e,r])=>[e,{...r,successRate:r.total>0?r.successful/r.total:0}]))}}reset(){this.stats={total:0,successful:0,failed:0,byFormat:{[d.PLAY_PATH]:{total:0,successful:0,failed:0},[d.ENCODED_ID]:{total:0,successful:0,failed:0}},errors:[]}}},Xs=new Rt});function Ot(t){if(!t||!Array.isArray(t)||t.length===0)return F.\u5176\u4ED6;let e=t[0];return F[e]||F.\u5176\u4ED6}function Dt(t){(!t||isNaN(t))&&(t=Date.now());let e=new Date(t);return isNaN(e.getTime())&&(e=new Date),new Date(e.getTime()+8*60*60*1e3).toISOString().slice(0,19).replace("T"," ")}function Ct(t){if(!t||!Array.isArray(t)||t.length===0)return new Date().getFullYear().toString();let e=parseInt(t[0]);return isNaN(e)||e<1900||e>new Date().getFullYear()+10?new Date().getFullYear().toString():e.toString()}function Z(t){let e=t.match(/(\d+)/);return e?parseInt(e[1]):0}function ee(t,e,r="https://myself-bbs.jacob.workers.dev"){if(!t||typeof t!="object")return"";let s=[],n=Object.entries(t).sort(([i],[o])=>{let a=Z(i),c=Z(o);return a-c});for(let[i,o]of n)if(Array.isArray(o)&&o.length>=2){let[a,c]=o,l=`${r}/m3u8/${a}/${c}`;s.push(`${i}$${l}`)}return s.join("#")}function Ds(t,e,r={}){let s={baseUrl:"https://myself-bbs.jacob.workers.dev",quality:M.HD720,enableFallback:!0,validateUrls:!1,...r};if(!t||typeof t!="object")return console.warn("Episodes \u8CC7\u6599\u7121\u6548\uFF0C\u8FD4\u56DE\u7A7A\u5B57\u4E32"),"";let n=Me(t);if(!n.isValid&&(console.warn("Episodes \u8CC7\u6599\u9A57\u8B49\u5931\u6557:",n.errors),!s.enableFallback))return"";let i=Pe(t);if(console.log(`\u6AA2\u6E2C\u5230 episodes \u683C\u5F0F: ${i.format}, \u4FE1\u5FC3\u5EA6: ${(i.confidence*100).toFixed(1)}%`),i.format===d.UNKNOWN)return console.warn("\u672A\u77E5\u7684 episodes \u683C\u5F0F\uFF0C\u4F7F\u7528\u820A\u7248\u672C\u8655\u7406\u908F\u8F2F"),s.enableFallback?ee(t,e,s.baseUrl):"";try{let o=i.details.isMixed,a=[];o?(console.log("\u8655\u7406\u6DF7\u5408\u683C\u5F0F episodes"),a=Cs(t,s)):a=Rr(t,i.format,{quality:s.quality,baseUrl:s.baseUrl});let c=a.sort((h,g)=>{let y=Z(h.name),w=Z(g.name);return y-w}),l=[],u=[];for(let h of c)if(h.success&&h.url)l.push(`${h.name}$${h.url}`);else if(u.push(h),s.enableFallback)try{let g=wr(h.name,h.value,e);l.push(`${h.name}$${g}`),console.warn(`\u4F7F\u7528\u964D\u7D1A URL: ${h.name} -> ${g}`)}catch(g){console.error(`\u964D\u7D1A\u8655\u7406\u4E5F\u5931\u6557: ${h.name}`,g)}u.length>0&&console.warn(`${u.length} \u500B episodes \u8655\u7406\u5931\u6557:`,u.map(h=>h.name));let m=l.length/Object.keys(t).length*100;return console.log(`URL \u751F\u6210\u6210\u529F\u7387: ${m.toFixed(1)}% (${l.length}/${Object.keys(t).length})`),l.join("#")}catch(o){return console.error("\u589E\u5F37\u7248 URL \u8F49\u63DB\u5931\u6557:",o),s.enableFallback?(console.log("\u964D\u7D1A\u5230\u820A\u7248\u672C convertPlayUrl"),ee(t,e,s.baseUrl)):""}}function Cs(t,e){let r=[];for(let[s,n]of Object.entries(t))try{let i=vs(n),o=null,a=!1;i===d.PLAY_PATH?(o=wt(n,{quality:e.quality,baseUrl:e.baseUrl}),a=!0):i===d.ENCODED_ID&&(o=It(n,{baseUrl:e.baseUrl}),a=!0),r.push({name:s,value:n,url:o,success:a,error:a?null:`\u4E0D\u652F\u63F4\u7684\u683C\u5F0F: ${i}`})}catch(i){r.push({name:s,value:n,url:null,success:!1,error:i.message})}return r}function vs(t){if(!t||typeof t!="string")return d.UNKNOWN;let e=t.trim();return/^play\/\d+\/\d+$/.test(e)?d.PLAY_PATH:/^[A-Za-z0-9_-]+$/.test(e)&&e.length>=10&&e.length<=30?d.ENCODED_ID:d.UNKNOWN}function Ts(t,e,r={}){let s={preferEnhanced:!0,fallbackToLegacy:!0,...r};if(s.preferEnhanced)try{let n=Pe(t);if(n.format!==d.UNKNOWN&&n.confidence>=.7)return Ds(t,e,r)}catch(n){console.warn("\u667A\u6167\u8F49\u63DB\u6AA2\u6E2C\u5931\u6557:",n)}return s.fallbackToLegacy?ee(t,e,r.baseUrl):""}function vt(t){return t.ep&&t.ep>0?`\u7B2C${t.ep}\u96C6`:t.status==="completed"?"\u5DF2\u5B8C\u7D50":t.status==="airing"?"\u9023\u8F09\u4E2D":"\u66F4\u65B0\u4E2D"}function Tt(t){return t.status==="completed"?"0":t.status==="airing"?"1":t.ep&&t.ep>=12?"0":"1"}function St(t){return t.voice_actors&&Array.isArray(t.voice_actors)?t.voice_actors.join(","):t.cast?t.cast:""}function Le(t,e={}){let{baseUrl:r="https://myself-bbs.jacob.workers.dev"}=e,s=Ot(t.category),n=Dt(t.time||Date.now()),i=vt(t);return{vod_id:parseInt(t.id),vod_name:t.title||"",type_id:s.type_id,type_name:s.type_name,vod_en:t.title||"",vod_time:n,vod_remarks:i,vod_play_from:"myself-bbs",vod_pic:t.image||""}}function bt(t,e={}){let{baseUrl:r="https://myself-bbs.jacob.workers.dev",useEnhancedPlayUrl:s=!0,quality:n=M.HD720}=e,i=Le(t,e),o="";return s?o=Ts(t.episodes,t.id,{baseUrl:r,quality:n,enableFallback:!0,preferEnhanced:!0}):o=ee(t.episodes,t.id,r),{...i,vod_area:"\u65E5\u672C",vod_lang:"\u65E5\u8A9E",vod_year:Ct(t.premiere),vod_serial:Tt(t),vod_actor:St(t),vod_director:t.author||"",vod_content:t.description||"",vod_play_url:o}}function pe(t,e="list",r={}){if(!Array.isArray(t))return[];let s=e==="detail"?bt:Le;return t.filter(n=>n&&n.id).map(n=>{try{return s(n,r)}catch(i){return console.warn(`\u8F49\u63DB\u9805\u76EE\u5931\u6557 (ID: ${n.id}):`,i),null}}).filter(n=>n!==null)}var F,xe=_(()=>{de();Nt();F={\u52D5\u4F5C:{type_id:1,type_name:"\u52D5\u4F5C"},\u5192\u96AA:{type_id:2,type_name:"\u5192\u96AA"},\u79D1\u5E7B:{type_id:3,type_name:"\u79D1\u5E7B"},\u5947\u5E7B:{type_id:4,type_name:"\u5947\u5E7B"},\u65E5\u5E38:{type_id:5,type_name:"\u65E5\u5E38"},\u6200\u611B:{type_id:6,type_name:"\u6200\u611B"},\u559C\u5287:{type_id:7,type_name:"\u559C\u5287"},\u5287\u60C5:{type_id:8,type_name:"\u5287\u60C5"},\u61F8\u7591:{type_id:9,type_name:"\u61F8\u7591"},\u6050\u6016:{type_id:10,type_name:"\u6050\u6016"},\u5176\u4ED6:{type_id:99,type_name:"\u5176\u4ED6"}}});var Ir={};Re(Ir,{calculatePagination:()=>fe,createCms10Response:()=>me,createErrorResponse:()=>R,createSuccessResponse:()=>te,paginateData:()=>ge,validateCms10Item:()=>Mt,validateCms10Response:()=>Pt});function me({code:t=1,msg:e="\u6578\u64DA\u5217\u8868",page:r=1,pagecount:s=1,limit:n="20",total:i=0,list:o=[]}){return{code:t,msg:e,page:parseInt(r),pagecount:parseInt(s),limit:n.toString(),total:parseInt(i),list:o}}function te(t,e={}){let{page:r=1,limit:s=20,total:n=t.length}=e,i=Math.ceil(n/s);return me({code:1,msg:"\u6578\u64DA\u5217\u8868",page:r,pagecount:i,limit:s.toString(),total:n,list:t})}function R(t,e){return me({code:t,msg:e||{0:"\u8ACB\u6C42\u5931\u6557",[-1]:"\u53C3\u6578\u932F\u8AA4",[-2]:"\u8CC7\u6599\u4E0D\u5B58\u5728"}[t]||"\u672A\u77E5\u932F\u8AA4",page:1,pagecount:0,limit:"20",total:0,list:[]})}function fe(t,e=1,r=20){let s=Math.max(1,parseInt(e)),n=Math.max(1,Math.min(100,parseInt(r))),i=Math.max(0,parseInt(t)),o=Math.ceil(i/n),a=(s-1)*n,c=Math.min(a+n,i);return{page:s,limit:n,total:i,pagecount:o,startIndex:a,endIndex:c,hasNext:s<o,hasPrev:s>1}}function ge(t,e=1,r=20){if(!Array.isArray(t))return{data:[],pagination:fe(0,e,r)};let s=fe(t.length,e,r);return{data:t.slice(s.startIndex,s.endIndex),pagination:s}}function Mt(t){let e=[],r=[],s=["vod_id","vod_name","type_id","type_name"];for(let n of s)(!t.hasOwnProperty(n)||t[n]===null||t[n]===void 0)&&e.push(`\u7F3A\u5C11\u5FC5\u8981\u6B04\u4F4D: ${n}`);return t.vod_id&&!Number.isInteger(t.vod_id)&&e.push("vod_id \u5FC5\u9808\u70BA\u6574\u6578"),t.type_id&&!Number.isInteger(t.type_id)&&e.push("type_id \u5FC5\u9808\u70BA\u6574\u6578"),t.vod_time&&!/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(t.vod_time)&&r.push("vod_time \u683C\u5F0F\u4E0D\u6B63\u78BA\uFF0C\u61C9\u70BA YYYY-MM-DD HH:mm:ss"),{isValid:e.length===0,errors:e,warnings:r}}function Pt(t){let e=[],r=["code","msg","page","pagecount","limit","total","list"];for(let s of r)t.hasOwnProperty(s)||e.push(`\u56DE\u61C9\u7F3A\u5C11\u5FC5\u8981\u6B04\u4F4D: ${s}`);return t.code!==void 0&&!Number.isInteger(t.code)&&e.push("code \u5FC5\u9808\u70BA\u6574\u6578"),t.page!==void 0&&!Number.isInteger(t.page)&&e.push("page \u5FC5\u9808\u70BA\u6574\u6578"),t.list!==void 0&&!Array.isArray(t.list)&&e.push("list \u5FC5\u9808\u70BA\u9663\u5217"),{isValid:e.length===0,errors:e}}var $e=_(()=>{});function Lt(t,e){if(!Array.isArray(t)||!e)return t;let r=parseInt(e),s={};for(let[i,o]of Object.entries(F))s[o.type_id]=i;let n=s[r];return n?t.filter(i=>!i.category||!Array.isArray(i.category)?!1:i.category.includes(n)):[]}function xt(t,e){if(!Array.isArray(t)||!e||typeof e!="string")return t;let r=e.toLowerCase().trim();return r.length===0?t:t.filter(s=>s.title&&s.title.toLowerCase().includes(r)||s.description&&s.description.toLowerCase().includes(r)||s.author&&s.author.toLowerCase().includes(r)?!0:s.category&&Array.isArray(s.category)?s.category.some(n=>n&&n.toLowerCase().includes(r)):!1)}function $t(t,e){if(!Array.isArray(t)||!e)return t;let r=parseInt(e);if(isNaN(r)||r<=0)return t;let s=Date.now()-r*60*60*1e3;return t.filter(n=>{let i=n.time||n.updated_at||n.created_at;return i?(typeof i=="number"?i:new Date(i).getTime())>=s:!1})}function Ut(t,e){if(!Array.isArray(t)||!e)return t;let r=e.split(",").map(s=>parseInt(s.trim())).filter(s=>!isNaN(s));return r.length===0?[]:t.filter(s=>{let n=parseInt(s.id);return r.includes(n)})}function Ft(t,e="time",r="desc"){if(!Array.isArray(t))return[];let s=[...t],n=r.toLowerCase()==="asc";return s.sort((i,o)=>{let a,c;switch(e){case"time":a=i.time||i.updated_at||i.created_at||0,c=o.time||o.updated_at||o.created_at||0;break;case"title":a=(i.title||"").toLowerCase(),c=(o.title||"").toLowerCase();break;case"id":a=parseInt(i.id)||0,c=parseInt(o.id)||0;break;case"ep":a=parseInt(i.ep)||0,c=parseInt(o.ep)||0;break;default:return 0}return a<c?n?-1:1:a>c?n?1:-1:0}),s}function ye(t,e={}){if(!Array.isArray(t))return[];let r=[...t];return e.t&&(r=Lt(r,e.t)),e.wd&&(r=xt(r,e.wd)),e.h&&(r=$t(r,e.h)),e.ids&&(r=Ut(r,e.ids)),e.sort&&(r=Ft(r,e.sort,e.order)),r}function Nr(){return Object.values(F)}function Or(t){if(!Array.isArray(t))return{};let e={};return t.forEach(r=>{r.category&&Array.isArray(r.category)&&r.category.forEach(s=>{e[s]=(e[s]||0)+1})}),e}var kt=_(()=>{xe()});function Ue(t,e={},r={}){try{let s=B(t);if(!s||s.length===0)return R(-2,"\u627E\u4E0D\u5230\u4EFB\u4F55\u8CC7\u6599");let n=ye(s,{t:e.t,wd:e.wd,h:e.h,ids:e.ids,sort:e.sort||"time",order:e.order||"desc"});if(n.length===0)return R(-2,"\u627E\u4E0D\u5230\u7B26\u5408\u689D\u4EF6\u7684\u8CC7\u6599");let{data:i,pagination:o}=ge(n,e.pg||1,e.limit||20),a=pe(i,"list",r);return te(a,o)}catch(s){return console.error("\u5217\u8868\u8F49\u63DB\u5931\u6557:",s),R(0,`\u8F49\u63DB\u5931\u6557: ${s.message}`)}}function Y(t,e={},r={}){try{let s={baseUrl:"https://myself-bbs.jacob.workers.dev",useEnhancedPlayUrl:!0,quality:M.HD720,enableFallback:!0,logEpisodeFormat:!0,...r};if(e.quality&&Object.values(M).includes(e.quality)&&(s.quality=e.quality),console.log(`\u8A73\u60C5\u8F49\u63DB\u958B\u59CB - \u589E\u5F37\u6A21\u5F0F: ${s.useEnhancedPlayUrl}, \u54C1\u8CEA: ${s.quality}`),!Array.isArray(t)||t.length===0)return R(-2,"\u627E\u4E0D\u5230\u6307\u5B9A\u7684\u8CC7\u6599");let n=t.filter(c=>c&&c.id);if(n.length===0)return R(-2,"\u627E\u4E0D\u5230\u6709\u6548\u7684\u8CC7\u6599\u9805\u76EE");console.log(`\u6709\u6548\u9805\u76EE\u6578\u91CF: ${n.length}`);let i=n;if(e.h){if(i=ye(n,{h:e.h}),i.length===0)return R(-2,"\u627E\u4E0D\u5230\u7B26\u5408\u6642\u9593\u689D\u4EF6\u7684\u8CC7\u6599");console.log(`\u6642\u9593\u7BE9\u9078\u5F8C\u9805\u76EE\u6578\u91CF: ${i.length}`)}s.useEnhancedPlayUrl&&s.logEpisodeFormat&&Ss(i);let o=pe(i,"detail",s);return o.length===0?R(0,"\u8CC7\u6599\u8F49\u63DB\u5931\u6557"):(console.log(`\u6210\u529F\u8F49\u63DB\u9805\u76EE\u6578\u91CF: ${o.length}`),te(o,{page:1,limit:o.length,total:o.length}))}catch(s){return console.error("\u8A73\u60C5\u8F49\u63DB\u5931\u6557:",s),R(0,`\u8F49\u63DB\u5931\u6557: ${s.message}`)}}function Ss(t){let e={[d.PLAY_PATH]:0,[d.ENCODED_ID]:0,[d.UNKNOWN]:0,total:0,withEpisodes:0,withoutEpisodes:0};for(let r of t){if(e.total++,!r.episodes||typeof r.episodes!="object"){e.withoutEpisodes++;continue}e.withEpisodes++;try{Promise.resolve().then(()=>(de(),Ar)).then(({detectEpisodesFormatCached:s})=>{let n=s(r.episodes);e[n.format]++})}catch(s){console.warn(`Episodes \u683C\u5F0F\u6AA2\u6E2C\u5931\u6557 (ID: ${r.id}):`,s),e[d.UNKNOWN]++}}console.log("Episodes \u683C\u5F0F\u5206\u6790:",{\u7E3D\u9805\u76EE\u6578:e.total,\u6709Episodes:e.withEpisodes,\u7121Episodes:e.withoutEpisodes,PlayPath\u683C\u5F0F:e[d.PLAY_PATH],EncodedID\u683C\u5F0F:e[d.ENCODED_ID],\u672A\u77E5\u683C\u5F0F:e[d.UNKNOWN]})}function B(t){return Array.isArray(t)?t:t?.data?.data&&Array.isArray(t.data.data)?t.data.data:t?.data&&Array.isArray(t.data)?t.data:t?.list&&Array.isArray(t.list)?t.list:[]}function re(t){if(!Array.isArray(t))return[];let e=[],r=new Set;for(let s of t){let n=B(s);for(let i of n)i&&i.id&&!r.has(i.id)&&(e.push(i),r.add(i.id))}return e}function Dr(t,e,r={},s={}){try{let n=re(t);if(n.length===0)return R(-2,"\u6C92\u6709\u53EF\u641C\u5C0B\u7684\u8CC7\u6599");let i={...r,wd:e};return Ue({data:{data:n}},i,s)}catch(n){return console.error("\u641C\u5C0B\u8655\u7406\u5931\u6557:",n),R(0,`\u641C\u5C0B\u5931\u6557: ${n.message}`)}}function Cr(t,e,r={},s={}){try{let n=re(t);if(n.length===0)return R(-2,"\u6C92\u6709\u53EF\u7BE9\u9078\u7684\u8CC7\u6599");let i={...r,t:e};return Ue({data:{data:n}},i,s)}catch(n){return console.error("\u5206\u985E\u8655\u7406\u5931\u6557:",n),R(0,`\u5206\u985E\u7BE9\u9078\u5931\u6557: ${n.message}`)}}function vr(t){if(!Array.isArray(t))return{total:0,valid:0,invalid:0,issues:["\u8F38\u5165\u4E0D\u662F\u9663\u5217"]};let e=[],r=0,s=0;return t.forEach((n,i)=>{let o=[];n?(n.id||o.push("\u7F3A\u5C11 ID"),n.title||o.push("\u7F3A\u5C11\u6A19\u984C"),(!n.category||!Array.isArray(n.category))&&o.push("\u7F3A\u5C11\u6216\u7121\u6548\u7684\u5206\u985E")):o.push("\u9805\u76EE\u70BA\u7A7A"),o.length>0?(e.push(`\u9805\u76EE ${i}: ${o.join(", ")}`),s++):r++}),{total:t.length,valid:r,invalid:s,issues:e}}function Vt(t,e={},r={}){return Y(t,e,{useEnhancedPlayUrl:!0,enableFallback:!0,logEpisodeFormat:!0,quality:e.quality||M.HD720,...r})}function jt(t,e={},r={}){return Y(t,e,{useEnhancedPlayUrl:!1,enableFallback:!1,logEpisodeFormat:!1,...r})}function Tr(t,e={},r={}){return t.some(n=>n.episodes?Object.values(n.episodes).some(o=>typeof o=="string"&&(o.startsWith("play/")||/^[A-Za-z0-9_-]{10,}$/.test(o))):!1)?(console.log("\u6AA2\u6E2C\u5230\u65B0\u683C\u5F0F episodes\uFF0C\u4F7F\u7528\u589E\u5F37\u7248\u8F49\u63DB"),Vt(t,e,r)):(console.log("\u4F7F\u7528\u50B3\u7D71\u683C\u5F0F episodes\uFF0C\u4F7F\u7528\u6A19\u6E96\u8F49\u63DB"),jt(t,e,r))}var Sr=_(()=>{xe();$e();kt();Nt();de()});function Ht(t,e,r){let s=[];if(r.required&&(e==null||e===""))return s.push(`\u7F3A\u5C11\u5FC5\u8981\u53C3\u6578\uFF1A${t}`),{isValid:!1,errors:s};if(e==null||e==="")return{isValid:!0,errors:[]};if(r.type==="number"){let n=Number(e);isNaN(n)?s.push(`${t} \u5FC5\u9808\u70BA\u6578\u5B57`):(e=n,r.min!==void 0&&e<r.min&&s.push(`${t} \u4E0D\u80FD\u5C0F\u65BC ${r.min}`),r.max!==void 0&&e>r.max&&s.push(`${t} \u4E0D\u80FD\u5927\u65BC ${r.max}`))}if(r.type==="string"){let n=String(e);r.minLength!==void 0&&n.length<r.minLength&&s.push(`${t} \u9577\u5EA6\u4E0D\u80FD\u5C11\u65BC ${r.minLength} \u5B57\u5143`),r.maxLength!==void 0&&n.length>r.maxLength&&s.push(`${t} \u9577\u5EA6\u4E0D\u80FD\u8D85\u904E ${r.maxLength} \u5B57\u5143`),r.pattern&&!r.pattern.test(n)&&s.push(r.message||`${t} \u683C\u5F0F\u932F\u8AA4`),r.enum&&!r.enum.includes(n)&&s.push(`${t} \u5FC5\u9808\u70BA\u4EE5\u4E0B\u503C\u4E4B\u4E00\uFF1A${r.enum.join(", ")}`)}return{isValid:s.length===0,errors:s,value:e}}function Wt(t){let e=[],r={};for(let[s,n]of Object.entries(qt)){let i=Ht(s,t[s],n);i.isValid?i.value!==void 0&&(r[s]=i.value):e.push(...i.errors)}return{isValid:e.length===0,errors:e,params:r}}function Kt(t){let e=[];return t.pg&&t.pg>1e3&&e.push("\u9801\u78BC\u904E\u5927\uFF0C\u5EFA\u8B70\u4F7F\u7528\u66F4\u7CBE\u78BA\u7684\u7BE9\u9078\u689D\u4EF6"),t.wd&&t.wd.length<2&&e.push("\u641C\u5C0B\u95DC\u9375\u5B57\u81F3\u5C11\u9700\u8981 2 \u500B\u5B57\u5143"),t.ids&&t.ids.split(",").length>50&&e.push("\u4E00\u6B21\u6700\u591A\u53EA\u80FD\u67E5\u8A62 50 \u500B ID"),t.order&&!t.sort&&e.push("\u6307\u5B9A order \u53C3\u6578\u6642\u5FC5\u9808\u540C\u6642\u6307\u5B9A sort \u53C3\u6578"),{isValid:e.length===0,errors:e}}function Fe(t){let e=Wt(t);if(!e.isValid)return{isValid:!1,errors:e.errors,params:{},businessErrors:[]};let r=Kt(e.params);return{isValid:r.isValid,errors:e.errors,params:e.params,businessErrors:r.errors}}function br(t){let e=[];if(!t||typeof t!="string")return e.push("IDs \u53C3\u6578\u5FC5\u9808\u70BA\u5B57\u4E32"),{isValid:!1,ids:[],errors:e};let r=[],s=t.split(",");for(let i of s){let o=i.trim(),a=parseInt(o);isNaN(a)||a<=0?e.push(`\u7121\u6548\u7684 ID: ${o}`):r.push(a)}let n=[...new Set(r)];return n.length!==r.length&&e.push("ID \u5217\u8868\u5305\u542B\u91CD\u8907\u9805\u76EE"),{isValid:e.length===0,ids:n,errors:e}}function Mr(t,e){let r=[],s=1,n=20;if(t!==void 0){let i=parseInt(t);isNaN(i)||i<1?r.push("\u9801\u78BC\u5FC5\u9808\u70BA\u5927\u65BC 0 \u7684\u6574\u6578"):i>1e4?r.push("\u9801\u78BC\u4E0D\u80FD\u8D85\u904E 10000"):s=i}if(e!==void 0){let i=parseInt(e);isNaN(i)||i<1?r.push("\u6BCF\u9801\u6578\u91CF\u5FC5\u9808\u70BA\u5927\u65BC 0 \u7684\u6574\u6578"):i>100?r.push("\u6BCF\u9801\u6578\u91CF\u4E0D\u80FD\u8D85\u904E 100"):n=i}return{isValid:r.length===0,page:s,limit:n,errors:r}}function Pr(t){let e=[];if(!t||typeof t!="string")return e.push("\u641C\u5C0B\u95DC\u9375\u5B57\u5FC5\u9808\u70BA\u5B57\u4E32"),{isValid:!1,keyword:"",errors:e};let r=t.trim();return r.length===0?e.push("\u641C\u5C0B\u95DC\u9375\u5B57\u4E0D\u80FD\u70BA\u7A7A"):r.length<2?e.push("\u641C\u5C0B\u95DC\u9375\u5B57\u81F3\u5C11\u9700\u8981 2 \u500B\u5B57\u5143"):r.length>100&&e.push("\u641C\u5C0B\u95DC\u9375\u5B57\u4E0D\u80FD\u8D85\u904E 100 \u500B\u5B57\u5143"),/[<>'"&]/.test(r)&&e.push("\u641C\u5C0B\u95DC\u9375\u5B57\u5305\u542B\u7121\u6548\u5B57\u5143"),{isValid:e.length===0,keyword:r,errors:e}}function se(t){let e=t.join("; ");return ce("validation",e)}var qt,Lr=_(()=>{Se();qt={ac:{required:!0,type:"string",enum:["videolist","list"],message:"ac \u53C3\u6578\u5FC5\u9808\u70BA videolist \u6216 list (\u5411\u5F8C\u76F8\u5BB9)"},ids:{required:!1,type:"string",pattern:/^\d+(,\d+)*$/,message:"ids \u53C3\u6578\u683C\u5F0F\u932F\u8AA4\uFF0C\u61C9\u70BA\u6578\u5B57\u6216\u9017\u865F\u5206\u9694\u7684\u6578\u5B57\u5217\u8868"},pg:{required:!1,type:"number",min:1,max:1e4,message:"pg \u53C3\u6578\u5FC5\u9808\u70BA 1-10000 \u4E4B\u9593\u7684\u6574\u6578"},t:{required:!1,type:"number",min:1,max:99,message:"t \u53C3\u6578\u5FC5\u9808\u70BA 1-99 \u4E4B\u9593\u7684\u6574\u6578"},h:{required:!1,type:"number",min:1,max:8760,message:"h \u53C3\u6578\u5FC5\u9808\u70BA 1-8760 \u4E4B\u9593\u7684\u6574\u6578"},wd:{required:!1,type:"string",minLength:1,maxLength:100,message:"wd \u53C3\u6578\u9577\u5EA6\u5FC5\u9808\u70BA 1-100 \u5B57\u5143"},limit:{required:!1,type:"number",min:1,max:100,message:"limit \u53C3\u6578\u5FC5\u9808\u70BA 1-100 \u4E4B\u9593\u7684\u6574\u6578"},sort:{required:!1,type:"string",enum:["time","title","id","ep"],message:"sort \u53C3\u6578\u5FC5\u9808\u70BA time, title, id, ep \u4E4B\u4E00"},order:{required:!1,type:"string",enum:["asc","desc"],message:"order \u53C3\u6578\u5FC5\u9808\u70BA asc \u6216 desc"}}});var Ve={};Re(Ve,{CATEGORY_MAPPING:()=>F,CMS10_VERSION:()=>bs,Cms10Error:()=>A,DEFAULT_CONFIG:()=>ke,ERROR_CODE_MAPPING:()=>mt,ErrorLogger:()=>G,ErrorMessages:()=>Te,ErrorStats:()=>le,ErrorTypes:()=>f,ValidationRules:()=>qt,applyFilters:()=>ye,batchConvertItems:()=>pe,calculatePagination:()=>fe,checkDataQuality:()=>vr,convertDetailResponse:()=>Y,convertDetailResponseEnhanced:()=>Vt,convertDetailResponseLegacy:()=>jt,convertDetailResponseSmart:()=>Tr,convertListResponse:()=>Ue,convertPlayUrl:()=>ee,convertPremiereToYear:()=>Ct,convertTimestamp:()=>Dt,convertToDetailItem:()=>bt,convertToListItem:()=>Le,createCms10Response:()=>me,createCms10Router:()=>Yt,createDataConversionError:()=>hr,createDataNotFoundError:()=>W,createDetailedErrorResponse:()=>fr,createErrorResponse:()=>R,createMissingParameterError:()=>dr,createNetworkError:()=>gt,createParameterError:()=>ce,createRateLimiter:()=>yr,createRouteConfig:()=>Ge,createSuccessResponse:()=>te,createSystemError:()=>K,createValidationError:()=>se,determineSerialStatus:()=>Tt,errorStats:()=>be,extractActors:()=>St,extractDataItems:()=>B,extractEpisodeNumber:()=>Z,extractRequestContext:()=>yt,fetchWithRetry:()=>mr,filterByCategory:()=>Lt,filterByIds:()=>Ut,filterByUpdateTime:()=>$t,formatRemarks:()=>vt,generateRouteDocs:()=>Ur,getAvailableCategories:()=>Nr,getCategoryMapping:()=>Ot,getCategoryStats:()=>Or,getCms10Categories:()=>qe,getCms10Info:()=>He,getLocalizedErrorMessage:()=>pr,handleCms10Category:()=>$r,handleCms10List:()=>z,handleCms10Request:()=>je,handleCms10Search:()=>xr,handleCms10VideoList:()=>z,healthCheck:()=>We,integrateCms10Routes:()=>Ke,mapErrorToCms10:()=>X,mergeDataSources:()=>re,paginateData:()=>ge,processCategoryRequest:()=>Cr,processSearchRequest:()=>Dr,searchByKeyword:()=>xt,sortItems:()=>Ft,validateBusinessLogic:()=>Kt,validateCms10Item:()=>Mt,validateCms10Response:()=>Pt,validateFullQuery:()=>Fe,validateIds:()=>br,validatePagination:()=>Mr,validateParameter:()=>Ht,validateQuery:()=>Wt,validateRouteConfig:()=>Fr,validateSearchKeyword:()=>Pr,withErrorHandling:()=>U,withFallback:()=>gr});var bs,ke,Ee=_(()=>{xe();$e();kt();Sr();Se();Lr();Et();Gt();Bt();bs={version:"2.0.0",buildDate:"2025-07-26",description:"Myself-BBS to CMS10 Conversion Module with Enhanced vod_play_url Support",features:{enhanced_play_url:!0,episode_format_detection:!0,multiple_video_qualities:!0,fallback_support:!0,url_validation:!0}},ke={baseUrl:"https://myself-bbs.jacob.workers.dev",defaultLimit:20,maxLimit:100,timezone:"Asia/Taipei"}});async function z(t){try{let e=Fe(t);if(!e.isValid){let u=[...e.errors,...e.businessErrors];throw se(u)}let r=e.params;if(r.ids)return await Ms(r);let[s,n]=await Promise.all([j().catch(u=>(console.warn("\u7372\u53D6\u9023\u8F09\u5217\u8868\u5931\u6557:",u.message),{data:{data:[]}})),q().catch(u=>(console.warn("\u7372\u53D6\u5B8C\u7D50\u5217\u8868\u5931\u6557:",u.message),{data:{data:[]}}))]),i=B(s),o=B(n);if(i.length===0&&o.length===0)throw W("anime_list","all");let a=re([s,n]);if(a.length===0)throw W("anime","any");let c=await Ps(a,r),l=Y(c,r,{baseUrl:ke.baseUrl,useEnhancedPlayUrl:!0,quality:r.quality||"720p"});return E({data:JSON.stringify(l,null,2)})}catch(e){throw e}}async function Ms(t){let r=t.ids.split(",").map(a=>parseInt(a.trim())).filter(a=>!isNaN(a)&&a>0);if(r.length===0)throw W("anime","invalid_ids");let s=r.map(async a=>{try{return await ie(a)}catch(c){return console.warn(`\u7372\u53D6\u52D5\u756B\u8A73\u60C5\u5931\u6557 (ID: ${a}):`,c.message),null}}),i=(await Promise.all(s)).filter(a=>a!==null);if(i.length===0)throw W("anime_details",r.join(","));let o=Y(i,t,{baseUrl:ke.baseUrl,useEnhancedPlayUrl:!0,quality:t.quality||"720p"});return E({data:JSON.stringify(o,null,2)})}async function Ps(t,e){let{applyFilters:r,paginateData:s}=await Promise.resolve().then(()=>(Ee(),Ve)),n=r(t,{t:e.t,wd:e.wd,h:e.h,sort:e.sort||"time",order:e.order||"desc"}),{data:i}=s(n,e.pg||1,e.limit||20),o=i.map(async c=>{try{return c.episodes?c:await ie(c.id)||c}catch(l){return console.warn(`\u7372\u53D6\u52D5\u756B\u8A73\u60C5\u5931\u6557 (ID: ${c.id}):`,l.message),c}});return(await Promise.all(o)).filter(c=>c!==null)}async function xr(t){return await z(t)}async function $r(t){return await z(t)}async function je(t){try{if(!t.ac)throw se(["\u7F3A\u5C11\u5FC5\u8981\u53C3\u6578\uFF1Aac"]);switch(t.ac){case"videolist":return await z(t);case"list":return await z(t);default:throw se([`\u4E0D\u652F\u63F4\u7684\u64CD\u4F5C\u985E\u578B\uFF1A${t.ac}\uFF0C\u8ACB\u4F7F\u7528 'videolist'`])}}catch(e){throw e}}async function qe(){try{let{getAvailableCategories:t}=await Promise.resolve().then(()=>(Ee(),Ve)),e=t(),r={code:1,msg:"\u5206\u985E\u5217\u8868",page:1,pagecount:1,limit:e.length.toString(),total:e.length,list:e};return E({data:JSON.stringify(r,null,2)})}catch(t){throw K("\u7372\u53D6\u5206\u985E\u5217\u8868\u5931\u6557",t)}}async function He(){try{let{CMS10_VERSION:t}=await Promise.resolve().then(()=>(Ee(),Ve)),e={name:"Myself-BBS CMS10 API",version:t.version,buildDate:t.buildDate,description:t.description,endpoints:{videolist:"/api.php/provide/vod/?ac=videolist",specific:"/api.php/provide/vod/?ac=videolist&ids={ids}",search:"/api.php/provide/vod/?ac=videolist&wd={keyword}",category:"/api.php/provide/vod/?ac=videolist&t={type_id}"},parameters:{ac:"\u64CD\u4F5C\u985E\u578B (videolist)",ids:"ID\u5217\u8868\uFF0C\u9017\u865F\u5206\u9694 (\u53EF\u9078\uFF0C\u6307\u5B9A\u7279\u5B9A\u5F71\u7247)",pg:"\u9801\u78BC\uFF0C\u9810\u8A2D1",limit:"\u6BCF\u9801\u6578\u91CF\uFF0C\u9810\u8A2D20\uFF0C\u6700\u5927100",t:"\u5206\u985EID\uFF0C1-99",wd:"\u641C\u5C0B\u95DC\u9375\u5B57",h:"\u66F4\u65B0\u6642\u9593\u7BE9\u9078\uFF0C\u5C0F\u6642\u6578",quality:"\u5F71\u7247\u54C1\u8CEA (720p, 1080p, 480p)"}},r={code:1,msg:"API\u8CC7\u8A0A",page:1,pagecount:1,limit:"1",total:1,list:[e]};return E({data:JSON.stringify(r,null,2)})}catch(t){throw K("\u7372\u53D6API\u8CC7\u8A0A\u5931\u6557",t)}}async function We(){try{let t=Date.now(),e=[j().then(()=>!0).catch(()=>!1),q().then(()=>!0).catch(()=>!1)],[r,s]=await Promise.all(e),n=Date.now()-t,i={status:"healthy",timestamp:new Date().toISOString(),responseTime:`${n}ms`,services:{airing_list:r?"ok":"error",completed_list:s?"ok":"error"},version:"1.0.0"},o={code:1,msg:"\u5065\u5EB7\u6AA2\u67E5",page:1,pagecount:1,limit:"1",total:1,list:[i]};return E({data:JSON.stringify(o,null,2)})}catch(t){throw K("\u5065\u5EB7\u6AA2\u67E5\u5931\u6557",t)}}var Gt=_(()=>{Ie();Qe();oe();Ee()});function Yt(){let t=we();return t.get("/api.php/provide/vod/",U(async e=>{let{query:r}=e;return await je(r)})),t.get("/api.php/provide/vod/categories",U(async e=>await qe())),t.get("/api.php/provide/vod/info",U(async e=>await He())),t.get("/api.php/provide/vod/health",U(async e=>await We())),t.all("/api.php/*",U(async e=>{let{createErrorResponse:r}=await Promise.resolve().then(()=>($e(),Ir)),s=r(-1,`\u4E0D\u652F\u63F4\u7684 CMS10 \u7AEF\u9EDE: ${new URL(e.url).pathname}`),{response:n}=await Promise.resolve().then(()=>(oe(),Xt));return n({data:JSON.stringify(s,null,2)})})),t}function Ke(t){let e=Yt();return t.all("/api.php/*",e.handle),t}function Ge(){return{legacy:{endpoints:[{path:"/list",description:"\u5217\u8868\u7D22\u5F15"},{path:"/list/completed",description:"\u5B8C\u7D50\u5217\u8868"},{path:"/list/airing",description:"\u9023\u8F09\u5217\u8868"},{path:"/anime/all",description:"\u6240\u6709\u52D5\u756B"},{path:"/anime/:id",description:"\u52D5\u756B\u8A73\u60C5"},{path:"/m3u8/:id/:ep",description:"\u64AD\u653E\u5730\u5740"},{path:"/search/:query",description:"\u641C\u5C0B"}]},cms10:{endpoints:[{path:"/api.php/provide/vod/?ac=videolist",description:"CMS10 \u5217\u8868 API",parameters:[{name:"ac",required:!0,description:"\u64CD\u4F5C\u985E\u578B (list)"},{name:"pg",required:!1,description:"\u9801\u78BC"},{name:"limit",required:!1,description:"\u6BCF\u9801\u6578\u91CF"},{name:"t",required:!1,description:"\u5206\u985E ID"},{name:"wd",required:!1,description:"\u641C\u5C0B\u95DC\u9375\u5B57"},{name:"h",required:!1,description:"\u66F4\u65B0\u6642\u9593\u7BE9\u9078"}]},{path:"/api.php/provide/vod/?ac=videolist",description:"CMS10 \u8A73\u60C5 API",parameters:[{name:"ac",required:!0,description:"\u64CD\u4F5C\u985E\u578B (detail)"},{name:"ids",required:!0,description:"ID \u5217\u8868\uFF0C\u9017\u865F\u5206\u9694"},{name:"h",required:!1,description:"\u66F4\u65B0\u6642\u9593\u7BE9\u9078"}]},{path:"/api.php/provide/vod/categories",description:"\u5206\u985E\u5217\u8868 (\u64F4\u5C55)",parameters:[]},{path:"/api.php/provide/vod/info",description:"API \u8CC7\u8A0A (\u64F4\u5C55)",parameters:[]},{path:"/api.php/provide/vod/health",description:"\u5065\u5EB7\u6AA2\u67E5 (\u64F4\u5C55)",parameters:[]}]}}}function Ur(){let t=Ge();return{title:"Myself-BBS API \u8DEF\u7531\u6587\u4EF6",version:"1.0.0",description:"\u5305\u542B\u539F\u6709 API \u548C\u65B0\u589E CMS10 \u76F8\u5BB9 API \u7684\u5B8C\u6574\u8DEF\u7531\u6587\u4EF6",baseUrl:"https://myself-bbs.jacob.workers.dev",sections:[{title:"\u539F\u6709 API \u7AEF\u9EDE",description:"\u4FDD\u6301\u5411\u5F8C\u76F8\u5BB9\u7684\u539F\u6709 API \u7AEF\u9EDE",endpoints:t.legacy.endpoints.map(e=>({...e,fullUrl:`https://myself-bbs.jacob.workers.dev${e.path}`,method:"GET"}))},{title:"CMS10 \u76F8\u5BB9 API \u7AEF\u9EDE",description:"\u7B26\u5408 CMS10 \u6A19\u6E96\u7684\u65B0 API \u7AEF\u9EDE",endpoints:t.cms10.endpoints.map(e=>({...e,fullUrl:`https://myself-bbs.jacob.workers.dev${e.path}`,method:"GET"}))}],examples:{legacy:[{title:"\u7372\u53D6\u9023\u8F09\u5217\u8868",url:"/list/airing",description:"\u7372\u53D6\u6240\u6709\u9023\u8F09\u4E2D\u7684\u52D5\u756B\u5217\u8868"},{title:"\u641C\u5C0B\u52D5\u756B",url:"/search/\u9032\u64CA\u7684\u5DE8\u4EBA",description:"\u641C\u5C0B\u5305\u542B\u95DC\u9375\u5B57\u7684\u52D5\u756B"}],cms10:[{title:"CMS10 \u5217\u8868\u67E5\u8A62",url:"/api.php/provide/vod/?ac=videolist&pg=1&limit=20",description:"\u7372\u53D6\u7B2C\u4E00\u9801\u7684\u52D5\u756B\u5217\u8868\uFF0C\u6BCF\u980120\u9805"},{title:"CMS10 \u5206\u985E\u67E5\u8A62",url:"/api.php/provide/vod/?ac=videolist&t=1&pg=1",description:"\u7372\u53D6\u52D5\u4F5C\u5206\u985E\u7684\u52D5\u756B\u5217\u8868"},{title:"CMS10 \u641C\u5C0B\u67E5\u8A62",url:"/api.php/provide/vod/?ac=videolist&wd=\u5DE8\u4EBA&pg=1",description:"\u641C\u5C0B\u5305\u542B'\u5DE8\u4EBA'\u95DC\u9375\u5B57\u7684\u52D5\u756B"},{title:"CMS10 \u8A73\u60C5\u67E5\u8A62",url:"/api.php/provide/vod/?ac=videolist&ids=1,2,3",description:"\u7372\u53D6\u6307\u5B9A ID \u7684\u52D5\u756B\u8A73\u60C5"}]}}}function Fr(){let t=Ge(),e=[],r=[],s=[...t.legacy.endpoints.map(i=>i.path),...t.cms10.endpoints.map(i=>i.path)],n=s.filter((i,o)=>s.indexOf(i)!==o);return n.length>0&&e.push(`\u91CD\u8907\u7684\u8DEF\u7531\u8DEF\u5F91: ${n.join(", ")}`),t.cms10.endpoints.forEach(i=>{let o=i.parameters?.filter(a=>a.required)||[];i.path.includes("ac=videolist")&&!o.some(a=>a.name==="ids")&&r.push(`\u7AEF\u9EDE ${i.path} \u7F3A\u5C11\u5FC5\u8981\u53C3\u6578 ids \u7684\u5B9A\u7FA9`)}),{isValid:e.length===0,errors:e,warnings:r,summary:{totalEndpoints:s.length,legacyEndpoints:t.legacy.endpoints.length,cms10Endpoints:t.cms10.endpoints.length}}}var Bt=_(()=>{ze();Et();Gt()});ze();Qe();ne();Ie();oe();function S(t){return Array.isArray?Array.isArray(t):or(t)==="[object Array]"}var jr=1/0;function qr(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-jr?"-0":e}function Hr(t){return t==null?"":qr(t)}function D(t){return typeof t=="string"}function nr(t){return typeof t=="number"}function Wr(t){return t===!0||t===!1||Kr(t)&&or(t)=="[object Boolean]"}function ir(t){return typeof t=="object"}function Kr(t){return ir(t)&&t!==null}function I(t){return t!=null}function et(t){return!t.trim().length}function or(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var Gr="Incorrect 'index' type",Yr=t=>`Invalid value for key ${t}`,Br=t=>`Pattern length exceeds max of ${t}.`,zr=t=>`Missing ${t} property in key`,Jr=t=>`Property 'weight' in key '${t}' must be a positive integer`,Zt=Object.prototype.hasOwnProperty,tt=class{constructor(e){this._keys=[],this._keyMap={};let r=0;e.forEach(s=>{let n=ar(s);r+=n.weight,this._keys.push(n),this._keyMap[n.id]=n,r+=n.weight}),this._keys.forEach(s=>{s.weight/=r})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function ar(t){let e=null,r=null,s=null,n=1,i=null;if(D(t)||S(t))s=t,e=er(t),r=rt(t);else{if(!Zt.call(t,"name"))throw new Error(zr("name"));let o=t.name;if(s=o,Zt.call(t,"weight")&&(n=t.weight,n<=0))throw new Error(Jr(o));e=er(o),r=rt(o),i=t.getFn}return{path:e,id:r,weight:n,src:s,getFn:i}}function er(t){return S(t)?t:t.split(".")}function rt(t){return S(t)?t.join("."):t}function Qr(t,e){let r=[],s=!1,n=(i,o,a)=>{if(!!I(i))if(!o[a])r.push(i);else{let c=o[a],l=i[c];if(!I(l))return;if(a===o.length-1&&(D(l)||nr(l)||Wr(l)))r.push(Hr(l));else if(S(l)){s=!0;for(let u=0,m=l.length;u<m;u+=1)n(l[u],o,a+1)}else o.length&&n(l,o,a+1)}};return n(t,D(e)?e.split("."):e,0),s?r:r[0]}var Xr={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Zr={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},es={location:0,threshold:.6,distance:100},ts={useExtendedSearch:!1,getFn:Qr,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},p={...Zr,...Xr,...es,...ts},rs=/[^ ]+/g;function ss(t=1,e=3){let r=new Map,s=Math.pow(10,e);return{get(n){let i=n.match(rs).length;if(r.has(i))return r.get(i);let o=1/Math.pow(i,.5*t),a=parseFloat(Math.round(o*s)/s);return r.set(i,a),a},clear(){r.clear()}}}var ae=class{constructor({getFn:e=p.getFn,fieldNormWeight:r=p.fieldNormWeight}={}){this.norm=ss(r,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((r,s)=>{this._keysMap[r.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,D(this.docs[0])?this.docs.forEach((e,r)=>{this._addString(e,r)}):this.docs.forEach((e,r)=>{this._addObject(e,r)}),this.norm.clear())}add(e){let r=this.size();D(e)?this._addString(e,r):this._addObject(e,r)}removeAt(e){this.records.splice(e,1);for(let r=e,s=this.size();r<s;r+=1)this.records[r].i-=1}getValueForItemAtKeyId(e,r){return e[this._keysMap[r]]}size(){return this.records.length}_addString(e,r){if(!I(e)||et(e))return;let s={v:e,i:r,n:this.norm.get(e)};this.records.push(s)}_addObject(e,r){let s={i:r,$:{}};this.keys.forEach((n,i)=>{let o=n.getFn?n.getFn(e):this.getFn(e,n.path);if(!!I(o)){if(S(o)){let a=[],c=[{nestedArrIndex:-1,value:o}];for(;c.length;){let{nestedArrIndex:l,value:u}=c.pop();if(!!I(u))if(D(u)&&!et(u)){let m={v:u,i:l,n:this.norm.get(u)};a.push(m)}else S(u)&&u.forEach((m,h)=>{c.push({nestedArrIndex:h,value:m})})}s.$[i]=a}else if(D(o)&&!et(o)){let a={v:o,n:this.norm.get(o)};s.$[i]=a}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}};function cr(t,e,{getFn:r=p.getFn,fieldNormWeight:s=p.fieldNormWeight}={}){let n=new ae({getFn:r,fieldNormWeight:s});return n.setKeys(t.map(ar)),n.setSources(e),n.create(),n}function ns(t,{getFn:e=p.getFn,fieldNormWeight:r=p.fieldNormWeight}={}){let{keys:s,records:n}=t,i=new ae({getFn:e,fieldNormWeight:r});return i.setKeys(s),i.setIndexRecords(n),i}function Ne(t,{errors:e=0,currentLocation:r=0,expectedLocation:s=0,distance:n=p.distance,ignoreLocation:i=p.ignoreLocation}={}){let o=e/t.length;if(i)return o;let a=Math.abs(s-r);return n?o+a/n:a?1:o}function is(t=[],e=p.minMatchCharLength){let r=[],s=-1,n=-1,i=0;for(let o=t.length;i<o;i+=1){let a=t[i];a&&s===-1?s=i:!a&&s!==-1&&(n=i-1,n-s+1>=e&&r.push([s,n]),s=-1)}return t[i-1]&&i-s>=e&&r.push([s,i-1]),r}var H=32;function os(t,e,r,{location:s=p.location,distance:n=p.distance,threshold:i=p.threshold,findAllMatches:o=p.findAllMatches,minMatchCharLength:a=p.minMatchCharLength,includeMatches:c=p.includeMatches,ignoreLocation:l=p.ignoreLocation}={}){if(e.length>H)throw new Error(Br(H));let u=e.length,m=t.length,h=Math.max(0,Math.min(s,m)),g=i,y=h,w=a>1||c,k=w?Array(m):[],T;for(;(T=t.indexOf(e,y))>-1;){let N=Ne(e,{currentLocation:T,expectedLocation:h,distance:n,ignoreLocation:l});if(g=Math.min(N,g),y=T+u,w){let P=0;for(;P<u;)k[T+P]=1,P+=1}}y=-1;let J=[],V=1,Ae=u+m,kr=1<<u-1;for(let N=0;N<u;N+=1){let P=0,L=Ae;for(;P<L;)Ne(e,{errors:N,currentLocation:h+L,expectedLocation:h,distance:n,ignoreLocation:l})<=g?P=L:Ae=L,L=Math.floor((Ae-P)/2+P);Ae=L;let zt=Math.max(1,h-L+1),Be=o?m:Math.min(h+L,m)+u,Q=Array(Be+2);Q[Be+1]=(1<<N)-1;for(let O=Be;O>=zt;O-=1){let _e=O-1,Jt=r[t.charAt(_e)];if(w&&(k[_e]=+!!Jt),Q[O]=(Q[O+1]<<1|1)&Jt,N&&(Q[O]|=(J[O+1]|J[O])<<1|1|J[O+1]),Q[O]&kr&&(V=Ne(e,{errors:N,currentLocation:_e,expectedLocation:h,distance:n,ignoreLocation:l}),V<=g)){if(g=V,y=_e,y<=h)break;zt=Math.max(1,2*h-y)}}if(Ne(e,{errors:N+1,currentLocation:h,expectedLocation:h,distance:n,ignoreLocation:l})>g)break;J=Q}let Ye={isMatch:y>=0,score:Math.max(.001,V)};if(w){let N=is(k,a);N.length?c&&(Ye.indices=N):Ye.isMatch=!1}return Ye}function as(t){let e={};for(let r=0,s=t.length;r<s;r+=1){let n=t.charAt(r);e[n]=(e[n]||0)|1<<s-r-1}return e}var Oe=class{constructor(e,{location:r=p.location,threshold:s=p.threshold,distance:n=p.distance,includeMatches:i=p.includeMatches,findAllMatches:o=p.findAllMatches,minMatchCharLength:a=p.minMatchCharLength,isCaseSensitive:c=p.isCaseSensitive,ignoreLocation:l=p.ignoreLocation}={}){if(this.options={location:r,threshold:s,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:c,ignoreLocation:l},this.pattern=c?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;let u=(h,g)=>{this.chunks.push({pattern:h,alphabet:as(h),startIndex:g})},m=this.pattern.length;if(m>H){let h=0,g=m%H,y=m-g;for(;h<y;)u(this.pattern.substr(h,H),h),h+=H;if(g){let w=m-H;u(this.pattern.substr(w),w)}}else u(this.pattern,0)}searchIn(e){let{isCaseSensitive:r,includeMatches:s}=this.options;if(r||(e=e.toLowerCase()),this.pattern===e){let y={isMatch:!0,score:0};return s&&(y.indices=[[0,e.length-1]]),y}let{location:n,distance:i,threshold:o,findAllMatches:a,minMatchCharLength:c,ignoreLocation:l}=this.options,u=[],m=0,h=!1;this.chunks.forEach(({pattern:y,alphabet:w,startIndex:k})=>{let{isMatch:T,score:J,indices:V}=os(e,y,w,{location:n+k,distance:i,threshold:o,findAllMatches:a,minMatchCharLength:c,includeMatches:s,ignoreLocation:l});T&&(h=!0),m+=J,T&&V&&(u=[...u,...V])});let g={isMatch:h,score:h?m/this.chunks.length:1};return h&&s&&(g.indices=u),g}},C=class{constructor(e){this.pattern=e}static isMultiMatch(e){return tr(e,this.multiRegex)}static isSingleMatch(e){return tr(e,this.singleRegex)}search(){}};function tr(t,e){let r=t.match(e);return r?r[1]:null}var st=class extends C{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){let r=e===this.pattern;return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}},nt=class extends C{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){let s=e.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}},it=class extends C{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){let r=e.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}},ot=class extends C{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){let r=!e.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,e.length-1]}}},at=class extends C{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){let r=e.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},ct=class extends C{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){let r=!e.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,e.length-1]}}},De=class extends C{constructor(e,{location:r=p.location,threshold:s=p.threshold,distance:n=p.distance,includeMatches:i=p.includeMatches,findAllMatches:o=p.findAllMatches,minMatchCharLength:a=p.minMatchCharLength,isCaseSensitive:c=p.isCaseSensitive,ignoreLocation:l=p.ignoreLocation}={}){super(e),this._bitapSearch=new Oe(e,{location:r,threshold:s,distance:n,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:c,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}},Ce=class extends C{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let r=0,s,n=[],i=this.pattern.length;for(;(s=e.indexOf(this.pattern,r))>-1;)r=s+i,n.push([s,r-1]);let o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}},lt=[st,Ce,it,ot,ct,at,nt,De],rr=lt.length,cs=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,ls="|";function us(t,e={}){return t.split(ls).map(r=>{let s=r.trim().split(cs).filter(i=>i&&!!i.trim()),n=[];for(let i=0,o=s.length;i<o;i+=1){let a=s[i],c=!1,l=-1;for(;!c&&++l<rr;){let u=lt[l],m=u.isMultiMatch(a);m&&(n.push(new u(m,e)),c=!0)}if(!c)for(l=-1;++l<rr;){let u=lt[l],m=u.isSingleMatch(a);if(m){n.push(new u(m,e));break}}}return n})}var ds=new Set([De.type,Ce.type]),ut=class{constructor(e,{isCaseSensitive:r=p.isCaseSensitive,includeMatches:s=p.includeMatches,minMatchCharLength:n=p.minMatchCharLength,ignoreLocation:i=p.ignoreLocation,findAllMatches:o=p.findAllMatches,location:a=p.location,threshold:c=p.threshold,distance:l=p.distance}={}){this.query=null,this.options={isCaseSensitive:r,includeMatches:s,minMatchCharLength:n,findAllMatches:o,ignoreLocation:i,location:a,threshold:c,distance:l},this.pattern=r?e:e.toLowerCase(),this.query=us(this.pattern,this.options)}static condition(e,r){return r.useExtendedSearch}searchIn(e){let r=this.query;if(!r)return{isMatch:!1,score:1};let{includeMatches:s,isCaseSensitive:n}=this.options;e=n?e:e.toLowerCase();let i=0,o=[],a=0;for(let c=0,l=r.length;c<l;c+=1){let u=r[c];o.length=0,i=0;for(let m=0,h=u.length;m<h;m+=1){let g=u[m],{isMatch:y,indices:w,score:k}=g.search(e);if(y){if(i+=1,a+=k,s){let T=g.constructor.type;ds.has(T)?o=[...o,...w]:o.push(w)}}else{a=0,i=0,o.length=0;break}}if(i){let m={isMatch:!0,score:a/i};return s&&(m.indices=o),m}}return{isMatch:!1,score:1}}},dt=[];function hs(...t){dt.push(...t)}function ht(t,e){for(let r=0,s=dt.length;r<s;r+=1){let n=dt[r];if(n.condition(t,e))return new n(t,e)}return new Oe(t,e)}var ve={AND:"$and",OR:"$or"},pt={PATH:"$path",PATTERN:"$val"},ft=t=>!!(t[ve.AND]||t[ve.OR]),ps=t=>!!t[pt.PATH],fs=t=>!S(t)&&ir(t)&&!ft(t),sr=t=>({[ve.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function lr(t,e,{auto:r=!0}={}){let s=n=>{let i=Object.keys(n),o=ps(n);if(!o&&i.length>1&&!ft(n))return s(sr(n));if(fs(n)){let c=o?n[pt.PATH]:i[0],l=o?n[pt.PATTERN]:n[c];if(!D(l))throw new Error(Yr(c));let u={keyId:rt(c),pattern:l};return r&&(u.searcher=ht(l,e)),u}let a={children:[],operator:i[0]};return i.forEach(c=>{let l=n[c];S(l)&&l.forEach(u=>{a.children.push(s(u))})}),a};return ft(t)||(t=sr(t)),s(t)}function ms(t,{ignoreFieldNorm:e=p.ignoreFieldNorm}){t.forEach(r=>{let s=1;r.matches.forEach(({key:n,norm:i,score:o})=>{let a=n?n.weight:null;s*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(e?1:i))}),r.score=s})}function gs(t,e){let r=t.matches;e.matches=[],I(r)&&r.forEach(s=>{if(!I(s.indices)||!s.indices.length)return;let{indices:n,value:i}=s,o={indices:n,value:i};s.key&&(o.key=s.key.src),s.idx>-1&&(o.refIndex=s.idx),e.matches.push(o)})}function ys(t,e){e.score=t.score}function Es(t,e,{includeMatches:r=p.includeMatches,includeScore:s=p.includeScore}={}){let n=[];return r&&n.push(gs),s&&n.push(ys),t.map(i=>{let{idx:o}=i,a={item:e[o],refIndex:o};return n.length&&n.forEach(c=>{c(i,a)}),a})}var b=class{constructor(e,r={},s){this.options={...p,...r},this.options.useExtendedSearch,this._keyStore=new tt(this.options.keys),this.setCollection(e,s)}setCollection(e,r){if(this._docs=e,r&&!(r instanceof ae))throw new Error(Gr);this._myIndex=r||cr(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){!I(e)||(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){let r=[];for(let s=0,n=this._docs.length;s<n;s+=1){let i=this._docs[s];e(i,s)&&(this.removeAt(s),s-=1,n-=1,r.push(i))}return r}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:r=-1}={}){let{includeMatches:s,includeScore:n,shouldSort:i,sortFn:o,ignoreFieldNorm:a}=this.options,c=D(e)?D(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return ms(c,{ignoreFieldNorm:a}),i&&c.sort(o),nr(r)&&r>-1&&(c=c.slice(0,r)),Es(c,this._docs,{includeMatches:s,includeScore:n})}_searchStringList(e){let r=ht(e,this.options),{records:s}=this._myIndex,n=[];return s.forEach(({v:i,i:o,n:a})=>{if(!I(i))return;let{isMatch:c,score:l,indices:u}=r.searchIn(i);c&&n.push({item:i,idx:o,matches:[{score:l,value:i,norm:a,indices:u}]})}),n}_searchLogical(e){let r=lr(e,this.options),s=(a,c,l)=>{if(!a.children){let{keyId:m,searcher:h}=a,g=this._findMatches({key:this._keyStore.get(m),value:this._myIndex.getValueForItemAtKeyId(c,m),searcher:h});return g&&g.length?[{idx:l,item:c,matches:g}]:[]}let u=[];for(let m=0,h=a.children.length;m<h;m+=1){let g=a.children[m],y=s(g,c,l);if(y.length)u.push(...y);else if(a.operator===ve.AND)return[]}return u},n=this._myIndex.records,i={},o=[];return n.forEach(({$:a,i:c})=>{if(I(a)){let l=s(r,a,c);l.length&&(i[c]||(i[c]={idx:c,item:a,matches:[]},o.push(i[c])),l.forEach(({matches:u})=>{i[c].matches.push(...u)}))}}),o}_searchObjectList(e){let r=ht(e,this.options),{keys:s,records:n}=this._myIndex,i=[];return n.forEach(({$:o,i:a})=>{if(!I(o))return;let c=[];s.forEach((l,u)=>{c.push(...this._findMatches({key:l,value:o[u],searcher:r}))}),c.length&&i.push({idx:a,item:o,matches:c})}),i}_findMatches({key:e,value:r,searcher:s}){if(!I(r))return[];let n=[];if(S(r))r.forEach(({v:i,i:o,n:a})=>{if(!I(i))return;let{isMatch:c,score:l,indices:u}=s.searchIn(i);c&&n.push({score:l,key:e,value:i,idx:o,norm:a,indices:u})});else{let{v:i,n:o}=r,{isMatch:a,score:c,indices:l}=s.searchIn(i);a&&n.push({score:c,key:e,value:i,norm:o,indices:l})}return n}};b.version="6.6.2";b.createIndex=cr;b.parseIndex=ns;b.config=p;b.parseQuery=lr;hs(ut);Ie();async function ur(t){let e=[...(await j()).data,...(await q()).data],r={includeScore:!0,keys:["title"]};return new b(e,r).search(t).map(i=>i.item)}Bt();var v=we();Ke(v);v.get("/list",async t=>{let{query:e,url:r}=t,s=new URL(r).origin,n={completed:s+"/list/completed",airing:s+"/list/airing"};return E({data:JSON.stringify({data:n},null,e.min?0:2)})});v.get("/list/completed",async t=>{let{query:e}=t,r=await q();return E({data:JSON.stringify({data:r},null,e.min?0:2)})});v.get("/list/airing",async t=>{let{query:e}=t,r=await j();return E({data:JSON.stringify({data:r},null,e.min?0:2)})});v.get("/anime/all",async t=>{let{query:e}=t,r=await fetch(`${x}details.json`).then(s=>s.json());return E({data:JSON.stringify({data:r},null,e.min?0:2)})});v.get("/anime/:id",async t=>{let{query:e,params:r}=t,s=await ie(r.id);return E({data:JSON.stringify({data:s},null,e.min?0:2)})});v.get("/m3u8/:id/:ep",async t=>{let{query:e,params:r}=t,s=await Qt(r.id,r.ep);return E({data:JSON.stringify({data:s},null,e.min?0:2)})});v.get("/search/:query",async t=>{let{query:e,params:r}=t,s=await ur(decodeURIComponent(r.query));return E({data:JSON.stringify({data:s},null,e.min?0:2)})});v.all("*",async t=>{let{query:e}=t;return E({data:JSON.stringify({error:"Unknown Request"},null,e.min?0:2)})});var Hn={async fetch(t,e,r){try{return await v.handle(t)}catch(s){return console.error(s),E({data:JSON.stringify({error:s.message},null,2)})}},async scheduled(t,e,r){}};export{Hn as default};
