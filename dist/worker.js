var Ar=Object.defineProperty;var A=(e,t)=>()=>(e&&(t=e(e=0)),t);var Ut=(e,t)=>{for(var r in t)Ar(e,r,{get:t[r],enumerable:!0})};function pt({base:e="",routes:t=[]}={}){return{__proto__:new Proxy({},{get:(r,s,n)=>(i,...a)=>t.push([s.toUpperCase(),RegExp(`^${(e+i).replace(/(\/?)\*/g,"($1.*)?").replace(/(\/$)|((?<=\/)\/)/,"").replace(/:(\w+)(\?)?(\.)?/g,"$2(?<$1>[^/]+)$2$3").replace(/\.(?=[\w(])/,"\\.").replace(/\)\.\?\(([^\[]+)\[\^/g,"?)\\.?($1(?<=\\.)[^\\.")}/*$`),a])&&n}),routes:t,async handle(r,...s){let n,i,a=new URL(r.url);r.query=Object.fromEntries(a.searchParams);for(var[o,c,l]of t)if((o===r.method||o==="ALL")&&(i=a.pathname.match(c))){r.params=i.groups;for(var u of l)if((n=await u(r.proxy||r,...s))!==void 0)return n}}}}var Vt=A(()=>{});var x,b,Z=A(()=>{x="https://raw.githubusercontent.com/JacobLinCool/Myself-BBS-API/data/",b=`max-age=${300}, s-maxage=${300}, public`});async function ft(e){if(!jt[e]){let t=await fetch(`${x}details/${e}.json`,{headers:{"Cache-Control":b}});t.status===200&&(jt[e]=await t.json())}return jt[e]}async function ke(e,t){let r=await fetch(`${x}m3u8/${e}/${t}.m3u8`,{headers:{"Cache-Control":b}});return r.status===200?await r.text():null}var jt,Bt=A(()=>{Z();jt={}});async function U(){if(Gt===null){let e=await fetch(`${x}airing.json`,{headers:{"Cache-Control":b}});e.status===200&&(Gt=await e.json())}return Gt}async function V(){if(qt===null){let e=await fetch(`${x}completed.json`,{headers:{"Cache-Control":b}});e.status===200&&(qt=await e.json())}return qt}var Gt,qt,gt=A(()=>{Z();Gt=null,qt=null});var Fe={};Ut(Fe,{response:()=>m});function m({data:e="",status:t=200,headers:r={}}){let s=new Headers;s.append("Content-Type","application/json; charset=utf-8"),s.append("Access-Control-Allow-Origin","*"),s.append("Access-Control-Allow-Headers","*"),s.append("Access-Control-Allow-Methods","*"),s.append("Access-Control-Allow-Credentials","true"),s.append("Cache-Control",b),s.append("Cross-Origin-Resource-Policy","cross-origin");for(let n of Object.keys(r))s.append(n,r[n]);return new Response(e,{status:t,headers:s})}var tt=A(()=>{Z()});function rt(e,t="\u53C3\u6578\u7121\u6548"){return new E(h.INVALID_PARAMETER,`\u53C3\u6578\u932F\u8AA4\uFF1A${e} ${t}`,{parameter:e,reason:t})}function Xe(e){return new E(h.MISSING_PARAMETER,`\u7F3A\u5C11\u5FC5\u8981\u53C3\u6578\uFF1A${e}`,{parameter:e})}function B(e,t){return new E(h.DATA_NOT_FOUND,`\u8CC7\u6599\u4E0D\u5B58\u5728\uFF1A\u627E\u4E0D\u5230 ${e} (ID: ${t})`,{resource:e,id:t})}function G(e,t=null){return new E(h.INTERNAL_ERROR,`\u7CFB\u7D71\u932F\u8AA4\uFF1A${e}`,{originalError:t?.message})}function oe(e,t=null){return new E(h.NETWORK_ERROR,`\u7DB2\u8DEF\u932F\u8AA4\uFF1A${e}`,{originalError:t?.message})}function ze(e,t={}){return new E(h.DATA_CONVERSION_FAILED,`\u8CC7\u6599\u8F49\u63DB\u5931\u6557\uFF1A${e}`,{data:t})}function Y(e){return e instanceof E?e:e instanceof TypeError?rt("type",e.message):e instanceof RangeError?new E(h.PARAMETER_OUT_OF_RANGE,`\u53C3\u6578\u8D85\u51FA\u7BC4\u570D\uFF1A${e.message}`,{originalError:e.message}):e.name==="NetworkError"||e.code==="NETWORK_ERROR"?oe(e.message,e):e.name==="TimeoutError"||e.code==="TIMEOUT"?new E(h.TIMEOUT_ERROR,`\u8ACB\u6C42\u903E\u6642\uFF1A${e.message}`,{originalError:e.message}):G(e.message,e)}function Ze(e,t="zh-TW"){return _t[t]?.[e]||_t["zh-TW"][e]||"\u672A\u77E5\u932F\u8AA4"}var h,ae,E,_t,It=A(()=>{h={MISSING_PARAMETER:"MISSING_PARAMETER",INVALID_PARAMETER:"INVALID_PARAMETER",PARAMETER_OUT_OF_RANGE:"PARAMETER_OUT_OF_RANGE",DATA_NOT_FOUND:"DATA_NOT_FOUND",DATA_CORRUPTED:"DATA_CORRUPTED",DATA_CONVERSION_FAILED:"DATA_CONVERSION_FAILED",NETWORK_ERROR:"NETWORK_ERROR",TIMEOUT_ERROR:"TIMEOUT_ERROR",INTERNAL_ERROR:"INTERNAL_ERROR",INVALID_OPERATION:"INVALID_OPERATION",RESOURCE_LIMIT_EXCEEDED:"RESOURCE_LIMIT_EXCEEDED"},ae={[h.MISSING_PARAMETER]:-1,[h.INVALID_PARAMETER]:-1,[h.PARAMETER_OUT_OF_RANGE]:-1,[h.DATA_NOT_FOUND]:-2,[h.NETWORK_ERROR]:0,[h.TIMEOUT_ERROR]:0,[h.INTERNAL_ERROR]:0,[h.DATA_CORRUPTED]:0,[h.DATA_CONVERSION_FAILED]:0,[h.INVALID_OPERATION]:0,[h.RESOURCE_LIMIT_EXCEEDED]:0},E=class extends Error{constructor(t,r,s={}){super(r),this.name="Cms10Error",this.type=t,this.details=s,this.timestamp=new Date().toISOString()}getCms10Code(){return ae[this.type]||0}toCms10Response(){return{code:this.getCms10Code(),msg:this.message,page:1,pagecount:0,limit:"20",total:0,list:[]}}};_t={"zh-TW":{[h.MISSING_PARAMETER]:"\u7F3A\u5C11\u5FC5\u8981\u53C3\u6578",[h.INVALID_PARAMETER]:"\u53C3\u6578\u683C\u5F0F\u932F\u8AA4",[h.PARAMETER_OUT_OF_RANGE]:"\u53C3\u6578\u8D85\u51FA\u7BC4\u570D",[h.DATA_NOT_FOUND]:"\u627E\u4E0D\u5230\u6307\u5B9A\u7684\u8CC7\u6599",[h.DATA_CORRUPTED]:"\u8CC7\u6599\u5DF2\u640D\u58DE",[h.DATA_CONVERSION_FAILED]:"\u8CC7\u6599\u8F49\u63DB\u5931\u6557",[h.NETWORK_ERROR]:"\u7DB2\u8DEF\u9023\u7DDA\u932F\u8AA4",[h.INTERNAL_ERROR]:"\u7CFB\u7D71\u5167\u90E8\u932F\u8AA4",[h.TIMEOUT_ERROR]:"\u8ACB\u6C42\u903E\u6642",[h.INVALID_OPERATION]:"\u7121\u6548\u7684\u64CD\u4F5C",[h.RESOURCE_LIMIT_EXCEEDED]:"\u8CC7\u6E90\u9650\u5236\u8D85\u51FA"},en:{[h.MISSING_PARAMETER]:"Missing required parameter",[h.INVALID_PARAMETER]:"Invalid parameter format",[h.PARAMETER_OUT_OF_RANGE]:"Parameter out of range",[h.DATA_NOT_FOUND]:"Data not found",[h.DATA_CORRUPTED]:"Data corrupted",[h.DATA_CONVERSION_FAILED]:"Data conversion failed",[h.NETWORK_ERROR]:"Network connection error",[h.INTERNAL_ERROR]:"Internal server error",[h.TIMEOUT_ERROR]:"Request timeout",[h.INVALID_OPERATION]:"Invalid operation",[h.RESOURCE_LIMIT_EXCEEDED]:"Resource limit exceeded"}}});function P(e){return async t=>{let r=Date.now();try{let s=await e(t),n=Date.now()-r;return n>1e3&&q.logPerformance(e.name||"anonymous",n,{url:t.url,success:!0}),s}catch(s){let n=Date.now()-r,i=ce(t);if(q.log(s,i),q.logPerformance(e.name||"anonymous",n,{url:t.url,success:!1,errorType:s.type||s.name}),s instanceof E)return wt.record(s.type,{url:i.url,parameter:s.details?.parameter}),m({data:JSON.stringify(s.toCms10Response(),null,2)});let a=Y(s);return wt.record(a.type,{url:i.url,originalError:s.name}),m({data:JSON.stringify(a.toCms10Response(),null,2)})}}}function ce(e){let t=new URL(e.url);return{url:t.pathname+t.search,method:e.method,query:Object.fromEntries(t.searchParams),userAgent:e.headers.get("User-Agent")||"Unknown",ip:e.headers.get("CF-Connecting-IP")||e.headers.get("X-Forwarded-For")||e.headers.get("X-Real-IP")||"Unknown"}}function tr(e,t=!1){return e.toCms10Response()}async function er(e,t=3,r=1e3){let s;for(let n=0;n<=t;n++)try{return await e()}catch(i){s=i,n<t&&(console.warn(`\u91CD\u8A66 ${n+1}/${t}:`,i.message),await new Promise(a=>setTimeout(a,r*Math.pow(2,n))))}throw Y(s)}async function rr(e,t){try{return await e()}catch(r){console.warn("\u4E3B\u8981\u8655\u7406\u5931\u6557\uFF0C\u4F7F\u7528\u964D\u7D1A\u65B9\u6848:",r.message);try{return await t()}catch(s){throw Y(s)}}}function sr(e=100,t=6e4){let r=new Map;return s=>{let n=s.headers.get("CF-Connecting-IP")||s.headers.get("X-Forwarded-For")||"unknown",i=Date.now(),a=i-t;if(r.has(n)){let c=r.get(n).filter(l=>l>a);r.set(n,c)}else r.set(n,[]);let o=r.get(n);if(o.length>=e)throw new E("RESOURCE_LIMIT_EXCEEDED","\u8ACB\u6C42\u983B\u7387\u904E\u9AD8\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66",{ip:n,requestCount:o.length,windowMs:t});o.push(i)}}var q,st,wt,le=A(()=>{tt();It();q=class{static log(t,r={}){let s={timestamp:new Date().toISOString(),error:{name:t.name,message:t.message,type:t.type||"UNKNOWN",stack:t.stack},context:{url:r.url,method:r.method,query:r.query,userAgent:r.userAgent,ip:r.ip}};t instanceof E&&t.getCms10Code()===-1?console.warn("\u53C3\u6578\u932F\u8AA4:",JSON.stringify(s,null,2)):t instanceof E&&t.getCms10Code()===-2?console.info("\u8CC7\u6599\u4E0D\u5B58\u5728:",JSON.stringify(s,null,2)):console.error("\u7CFB\u7D71\u932F\u8AA4:",JSON.stringify(s,null,2))}static logPerformance(t,r,s={}){let n={timestamp:new Date().toISOString(),type:"PERFORMANCE",operation:t,duration:r,metadata:s};r>5e3?console.warn("\u6548\u80FD\u8B66\u544A:",JSON.stringify(n,null,2)):r>1e3&&console.info("\u6548\u80FD\u8CC7\u8A0A:",JSON.stringify(n,null,2))}},st=class{constructor(){this.stats=new Map,this.startTime=Date.now()}record(t,r={}){let s=this.stats.get(t)||{count:0,lastOccurred:null,metadata:[]};s.count++,s.lastOccurred=new Date().toISOString(),s.metadata.push({timestamp:new Date().toISOString(),...r}),s.metadata.length>100&&(s.metadata=s.metadata.slice(-100)),this.stats.set(t,s)}getStats(){let t={};for(let[r,s]of this.stats)t[r]={count:s.count,lastOccurred:s.lastOccurred,recentMetadata:s.metadata.slice(-10)};return t._summary={totalErrors:Array.from(this.stats.values()).reduce((r,s)=>r+s.count,0),uniqueErrorTypes:this.stats.size,uptime:Date.now()-this.startTime},t}reset(){this.stats.clear(),this.startTime=Date.now()}getErrorRate(t){let r=Array.from(this.stats.values()).reduce((s,n)=>s+n.count,0);return t>0?r/t:0}},wt=new st});function ue(e){if(!e||!Array.isArray(e)||e.length===0)return $.\u5176\u4ED6;let t=e[0];return $[t]||$.\u5176\u4ED6}function de(e){(!e||isNaN(e))&&(e=Date.now());let t=new Date(e);return isNaN(t.getTime())&&(t=new Date),new Date(t.getTime()+8*60*60*1e3).toISOString().slice(0,19).replace("T"," ")}function he(e){if(!e||!Array.isArray(e)||e.length===0)return new Date().getFullYear().toString();let t=parseInt(e[0]);return isNaN(t)||t<1900||t>new Date().getFullYear()+10?new Date().getFullYear().toString():t.toString()}function Ct(e){let t=e.match(/(\d+)/);return t?parseInt(t[1]):0}function pe(e,t,r="https://myself-bbs.jacob.workers.dev"){if(!e||typeof e!="object")return"";let s=[],n=Object.entries(e).sort(([i],[a])=>{let o=Ct(i),c=Ct(a);return o-c});for(let[i,a]of n)if(Array.isArray(a)&&a.length>=2){let[o,c]=a,l=`${r}/m3u8/${o}/${c}`;s.push(`${i}$${l}`)}return s.join("#")}function fe(e){return e.ep&&e.ep>0?`\u7B2C${e.ep}\u96C6`:e.status==="completed"?"\u5DF2\u5B8C\u7D50":e.status==="airing"?"\u9023\u8F09\u4E2D":"\u66F4\u65B0\u4E2D"}function ge(e){return e.status==="completed"?"0":e.status==="airing"?"1":e.ep&&e.ep>=12?"0":"1"}function me(e){return e.voice_actors&&Array.isArray(e.voice_actors)?e.voice_actors.join(","):e.cast?e.cast:""}function Ot(e,t={}){let{baseUrl:r="https://myself-bbs.jacob.workers.dev"}=t,s=ue(e.category),n=de(e.time||Date.now()),i=fe(e);return{vod_id:parseInt(e.id),vod_name:e.title||"",type_id:s.type_id,type_name:s.type_name,vod_en:e.title||"",vod_time:n,vod_remarks:i,vod_play_from:"myself-bbs",vod_pic:e.image||""}}function ye(e,t={}){let{baseUrl:r="https://myself-bbs.jacob.workers.dev"}=t;return{...Ot(e,t),vod_area:"\u65E5\u672C",vod_lang:"\u65E5\u8A9E",vod_year:he(e.premiere),vod_serial:ge(e),vod_actor:me(e),vod_director:e.author||"",vod_content:e.description||"",vod_play_url:pe(e.episodes,e.id,r)}}function nt(e,t="list",r={}){if(!Array.isArray(e))return[];let s=t==="detail"?ye:Ot;return e.filter(n=>n&&n.id).map(n=>{try{return s(n,r)}catch(i){return console.warn(`\u8F49\u63DB\u9805\u76EE\u5931\u6557 (ID: ${n.id}):`,i),null}}).filter(n=>n!==null)}var $,Nt=A(()=>{$={\u52D5\u4F5C:{type_id:1,type_name:"\u52D5\u4F5C"},\u5192\u96AA:{type_id:2,type_name:"\u5192\u96AA"},\u79D1\u5E7B:{type_id:3,type_name:"\u79D1\u5E7B"},\u5947\u5E7B:{type_id:4,type_name:"\u5947\u5E7B"},\u65E5\u5E38:{type_id:5,type_name:"\u65E5\u5E38"},\u6200\u611B:{type_id:6,type_name:"\u6200\u611B"},\u559C\u5287:{type_id:7,type_name:"\u559C\u5287"},\u5287\u60C5:{type_id:8,type_name:"\u5287\u60C5"},\u61F8\u7591:{type_id:9,type_name:"\u61F8\u7591"},\u6050\u6016:{type_id:10,type_name:"\u6050\u6016"},\u5176\u4ED6:{type_id:99,type_name:"\u5176\u4ED6"}}});var nr={};Ut(nr,{calculatePagination:()=>it,createCms10Response:()=>at,createErrorResponse:()=>R,createSuccessResponse:()=>Q,paginateData:()=>ot,validateCms10Item:()=>Ee,validateCms10Response:()=>Re});function at({code:e=1,msg:t="\u6578\u64DA\u5217\u8868",page:r=1,pagecount:s=1,limit:n="20",total:i=0,list:a=[]}){return{code:e,msg:t,page:parseInt(r),pagecount:parseInt(s),limit:n.toString(),total:parseInt(i),list:a}}function Q(e,t={}){let{page:r=1,limit:s=20,total:n=e.length}=t,i=Math.ceil(n/s);return at({code:1,msg:"\u6578\u64DA\u5217\u8868",page:r,pagecount:i,limit:s.toString(),total:n,list:e})}function R(e,t){return at({code:e,msg:t||{0:"\u8ACB\u6C42\u5931\u6557",[-1]:"\u53C3\u6578\u932F\u8AA4",[-2]:"\u8CC7\u6599\u4E0D\u5B58\u5728"}[e]||"\u672A\u77E5\u932F\u8AA4",page:1,pagecount:0,limit:"20",total:0,list:[]})}function it(e,t=1,r=20){let s=Math.max(1,parseInt(t)),n=Math.max(1,Math.min(100,parseInt(r))),i=Math.max(0,parseInt(e)),a=Math.ceil(i/n),o=(s-1)*n,c=Math.min(o+n,i);return{page:s,limit:n,total:i,pagecount:a,startIndex:o,endIndex:c,hasNext:s<a,hasPrev:s>1}}function ot(e,t=1,r=20){if(!Array.isArray(e))return{data:[],pagination:it(0,t,r)};let s=it(e.length,t,r);return{data:e.slice(s.startIndex,s.endIndex),pagination:s}}function Ee(e){let t=[],r=[],s=["vod_id","vod_name","type_id","type_name"];for(let n of s)(!e.hasOwnProperty(n)||e[n]===null||e[n]===void 0)&&t.push(`\u7F3A\u5C11\u5FC5\u8981\u6B04\u4F4D: ${n}`);return e.vod_id&&!Number.isInteger(e.vod_id)&&t.push("vod_id \u5FC5\u9808\u70BA\u6574\u6578"),e.type_id&&!Number.isInteger(e.type_id)&&t.push("type_id \u5FC5\u9808\u70BA\u6574\u6578"),e.vod_time&&!/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(e.vod_time)&&r.push("vod_time \u683C\u5F0F\u4E0D\u6B63\u78BA\uFF0C\u61C9\u70BA YYYY-MM-DD HH:mm:ss"),{isValid:t.length===0,errors:t,warnings:r}}function Re(e){let t=[],r=["code","msg","page","pagecount","limit","total","list"];for(let s of r)e.hasOwnProperty(s)||t.push(`\u56DE\u61C9\u7F3A\u5C11\u5FC5\u8981\u6B04\u4F4D: ${s}`);return e.code!==void 0&&!Number.isInteger(e.code)&&t.push("code \u5FC5\u9808\u70BA\u6574\u6578"),e.page!==void 0&&!Number.isInteger(e.page)&&t.push("page \u5FC5\u9808\u70BA\u6574\u6578"),e.list!==void 0&&!Array.isArray(e.list)&&t.push("list \u5FC5\u9808\u70BA\u9663\u5217"),{isValid:t.length===0,errors:t}}var Tt=A(()=>{});function Ae(e,t){if(!Array.isArray(e)||!t)return e;let r=parseInt(t),s={};for(let[i,a]of Object.entries($))s[a.type_id]=i;let n=s[r];return n?e.filter(i=>!i.category||!Array.isArray(i.category)?!1:i.category.includes(n)):[]}function _e(e,t){if(!Array.isArray(e)||!t||typeof t!="string")return e;let r=t.toLowerCase().trim();return r.length===0?e:e.filter(s=>s.title&&s.title.toLowerCase().includes(r)||s.description&&s.description.toLowerCase().includes(r)||s.author&&s.author.toLowerCase().includes(r)?!0:s.category&&Array.isArray(s.category)?s.category.some(n=>n&&n.toLowerCase().includes(r)):!1)}function Ie(e,t){if(!Array.isArray(e)||!t)return e;let r=parseInt(t);if(isNaN(r)||r<=0)return e;let s=Date.now()-r*60*60*1e3;return e.filter(n=>{let i=n.time||n.updated_at||n.created_at;return i?(typeof i=="number"?i:new Date(i).getTime())>=s:!1})}function we(e,t){if(!Array.isArray(e)||!t)return e;let r=t.split(",").map(s=>parseInt(s.trim())).filter(s=>!isNaN(s));return r.length===0?[]:e.filter(s=>{let n=parseInt(s.id);return r.includes(n)})}function Ce(e,t="time",r="desc"){if(!Array.isArray(e))return[];let s=[...e],n=r.toLowerCase()==="asc";return s.sort((i,a)=>{let o,c;switch(t){case"time":o=i.time||i.updated_at||i.created_at||0,c=a.time||a.updated_at||a.created_at||0;break;case"title":o=(i.title||"").toLowerCase(),c=(a.title||"").toLowerCase();break;case"id":o=parseInt(i.id)||0,c=parseInt(a.id)||0;break;case"ep":o=parseInt(i.ep)||0,c=parseInt(a.ep)||0;break;default:return 0}return o<c?n?-1:1:o>c?n?1:-1:0}),s}function ct(e,t={}){if(!Array.isArray(e))return[];let r=[...e];return t.t&&(r=Ae(r,t.t)),t.wd&&(r=_e(r,t.wd)),t.h&&(r=Ie(r,t.h)),t.ids&&(r=we(r,t.ids)),t.sort&&(r=Ce(r,t.sort,t.order)),r}function ir(){return Object.values($)}function ar(e){if(!Array.isArray(e))return{};let t={};return e.forEach(r=>{r.category&&Array.isArray(r.category)&&r.category.forEach(s=>{t[s]=(t[s]||0)+1})}),t}var Oe=A(()=>{Nt()});function X(e,t={},r={}){try{let s=J(e);if(!s||s.length===0)return R(-2,"\u627E\u4E0D\u5230\u4EFB\u4F55\u8CC7\u6599");let n=ct(s,{t:t.t,wd:t.wd,h:t.h,ids:t.ids,sort:t.sort||"time",order:t.order||"desc"});if(n.length===0)return R(-2,"\u627E\u4E0D\u5230\u7B26\u5408\u689D\u4EF6\u7684\u8CC7\u6599");let{data:i,pagination:a}=ot(n,t.pg||1,t.limit||20),o=nt(i,"list",r);return Q(o,a)}catch(s){return console.error("\u5217\u8868\u8F49\u63DB\u5931\u6557:",s),R(0,`\u8F49\u63DB\u5931\u6557: ${s.message}`)}}function vt(e,t={},r={}){try{if(!Array.isArray(e)||e.length===0)return R(-2,"\u627E\u4E0D\u5230\u6307\u5B9A\u7684\u8CC7\u6599");let s=e.filter(a=>a&&a.id);if(s.length===0)return R(-2,"\u627E\u4E0D\u5230\u6709\u6548\u7684\u8CC7\u6599\u9805\u76EE");let n=s;if(t.h&&(n=ct(s,{h:t.h}),n.length===0))return R(-2,"\u627E\u4E0D\u5230\u7B26\u5408\u6642\u9593\u689D\u4EF6\u7684\u8CC7\u6599");let i=nt(n,"detail",r);return i.length===0?R(0,"\u8CC7\u6599\u8F49\u63DB\u5931\u6557"):Q(i,{page:1,limit:i.length,total:i.length})}catch(s){return console.error("\u8A73\u60C5\u8F49\u63DB\u5931\u6557:",s),R(0,`\u8F49\u63DB\u5931\u6557: ${s.message}`)}}function J(e){return Array.isArray(e)?e:e?.data?.data&&Array.isArray(e.data.data)?e.data.data:e?.data&&Array.isArray(e.data)?e.data:e?.list&&Array.isArray(e.list)?e.list:[]}function z(e){if(!Array.isArray(e))return[];let t=[],r=new Set;for(let s of e){let n=J(s);for(let i of n)i&&i.id&&!r.has(i.id)&&(t.push(i),r.add(i.id))}return t}function or(e,t,r={},s={}){try{let n=z(e);if(n.length===0)return R(-2,"\u6C92\u6709\u53EF\u641C\u5C0B\u7684\u8CC7\u6599");let i={...r,wd:t};return X({data:{data:n}},i,s)}catch(n){return console.error("\u641C\u5C0B\u8655\u7406\u5931\u6557:",n),R(0,`\u641C\u5C0B\u5931\u6557: ${n.message}`)}}function cr(e,t,r={},s={}){try{let n=z(e);if(n.length===0)return R(-2,"\u6C92\u6709\u53EF\u7BE9\u9078\u7684\u8CC7\u6599");let i={...r,t};return X({data:{data:n}},i,s)}catch(n){return console.error("\u5206\u985E\u8655\u7406\u5931\u6557:",n),R(0,`\u5206\u985E\u7BE9\u9078\u5931\u6557: ${n.message}`)}}function lr(e){if(!Array.isArray(e))return{total:0,valid:0,invalid:0,issues:["\u8F38\u5165\u4E0D\u662F\u9663\u5217"]};let t=[],r=0,s=0;return e.forEach((n,i)=>{let a=[];n?(n.id||a.push("\u7F3A\u5C11 ID"),n.title||a.push("\u7F3A\u5C11\u6A19\u984C"),(!n.category||!Array.isArray(n.category))&&a.push("\u7F3A\u5C11\u6216\u7121\u6548\u7684\u5206\u985E")):a.push("\u9805\u76EE\u70BA\u7A7A"),a.length>0?(t.push(`\u9805\u76EE ${i}: ${a.join(", ")}`),s++):r++}),{total:e.length,valid:r,invalid:s,issues:t}}var ur=A(()=>{Nt();Tt();Oe()});function Te(e,t,r){let s=[];if(r.required&&(t==null||t===""))return s.push(`\u7F3A\u5C11\u5FC5\u8981\u53C3\u6578\uFF1A${e}`),{isValid:!1,errors:s};if(t==null||t==="")return{isValid:!0,errors:[]};if(r.type==="number"){let n=Number(t);isNaN(n)?s.push(`${e} \u5FC5\u9808\u70BA\u6578\u5B57`):(t=n,r.min!==void 0&&t<r.min&&s.push(`${e} \u4E0D\u80FD\u5C0F\u65BC ${r.min}`),r.max!==void 0&&t>r.max&&s.push(`${e} \u4E0D\u80FD\u5927\u65BC ${r.max}`))}if(r.type==="string"){let n=String(t);r.minLength!==void 0&&n.length<r.minLength&&s.push(`${e} \u9577\u5EA6\u4E0D\u80FD\u5C11\u65BC ${r.minLength} \u5B57\u5143`),r.maxLength!==void 0&&n.length>r.maxLength&&s.push(`${e} \u9577\u5EA6\u4E0D\u80FD\u8D85\u904E ${r.maxLength} \u5B57\u5143`),r.pattern&&!r.pattern.test(n)&&s.push(r.message||`${e} \u683C\u5F0F\u932F\u8AA4`),r.enum&&!r.enum.includes(n)&&s.push(`${e} \u5FC5\u9808\u70BA\u4EE5\u4E0B\u503C\u4E4B\u4E00\uFF1A${r.enum.join(", ")}`)}return{isValid:s.length===0,errors:s,value:t}}function ve(e){let t=[],r={};for(let[s,n]of Object.entries(Ne)){let i=Te(s,e[s],n);i.isValid?i.value!==void 0&&(r[s]=i.value):t.push(...i.errors)}return{isValid:t.length===0,errors:t,params:r}}function Me(e){let t=[];return e.ac==="detail"&&!e.ids&&t.push("detail \u64CD\u4F5C\u5FC5\u9808\u63D0\u4F9B ids \u53C3\u6578"),e.pg&&e.pg>1e3&&t.push("\u9801\u78BC\u904E\u5927\uFF0C\u5EFA\u8B70\u4F7F\u7528\u66F4\u7CBE\u78BA\u7684\u7BE9\u9078\u689D\u4EF6"),e.wd&&e.wd.length<2&&t.push("\u641C\u5C0B\u95DC\u9375\u5B57\u81F3\u5C11\u9700\u8981 2 \u500B\u5B57\u5143"),e.ids&&e.ids.split(",").length>50&&t.push("\u4E00\u6B21\u6700\u591A\u53EA\u80FD\u67E5\u8A62 50 \u500B ID"),e.order&&!e.sort&&t.push("\u6307\u5B9A order \u53C3\u6578\u6642\u5FC5\u9808\u540C\u6642\u6307\u5B9A sort \u53C3\u6578"),{isValid:t.length===0,errors:t}}function lt(e){let t=ve(e);if(!t.isValid)return{isValid:!1,errors:t.errors,params:{},businessErrors:[]};let r=Me(t.params);return{isValid:r.isValid,errors:t.errors,params:t.params,businessErrors:r.errors}}function dr(e){let t=[];if(!e||typeof e!="string")return t.push("IDs \u53C3\u6578\u5FC5\u9808\u70BA\u5B57\u4E32"),{isValid:!1,ids:[],errors:t};let r=[],s=e.split(",");for(let i of s){let a=i.trim(),o=parseInt(a);isNaN(o)||o<=0?t.push(`\u7121\u6548\u7684 ID: ${a}`):r.push(o)}let n=[...new Set(r)];return n.length!==r.length&&t.push("ID \u5217\u8868\u5305\u542B\u91CD\u8907\u9805\u76EE"),{isValid:t.length===0,ids:n,errors:t}}function hr(e,t){let r=[],s=1,n=20;if(e!==void 0){let i=parseInt(e);isNaN(i)||i<1?r.push("\u9801\u78BC\u5FC5\u9808\u70BA\u5927\u65BC 0 \u7684\u6574\u6578"):i>1e4?r.push("\u9801\u78BC\u4E0D\u80FD\u8D85\u904E 10000"):s=i}if(t!==void 0){let i=parseInt(t);isNaN(i)||i<1?r.push("\u6BCF\u9801\u6578\u91CF\u5FC5\u9808\u70BA\u5927\u65BC 0 \u7684\u6574\u6578"):i>100?r.push("\u6BCF\u9801\u6578\u91CF\u4E0D\u80FD\u8D85\u904E 100"):n=i}return{isValid:r.length===0,page:s,limit:n,errors:r}}function pr(e){let t=[];if(!e||typeof e!="string")return t.push("\u641C\u5C0B\u95DC\u9375\u5B57\u5FC5\u9808\u70BA\u5B57\u4E32"),{isValid:!1,keyword:"",errors:t};let r=e.trim();return r.length===0?t.push("\u641C\u5C0B\u95DC\u9375\u5B57\u4E0D\u80FD\u70BA\u7A7A"):r.length<2?t.push("\u641C\u5C0B\u95DC\u9375\u5B57\u81F3\u5C11\u9700\u8981 2 \u500B\u5B57\u5143"):r.length>100&&t.push("\u641C\u5C0B\u95DC\u9375\u5B57\u4E0D\u80FD\u8D85\u904E 100 \u500B\u5B57\u5143"),/[<>'"&]/.test(r)&&t.push("\u641C\u5C0B\u95DC\u9375\u5B57\u5305\u542B\u7121\u6548\u5B57\u5143"),{isValid:t.length===0,keyword:r,errors:t}}function K(e){let t=e.join("; ");return rt("validation",t)}var Ne,fr=A(()=>{It();Ne={ac:{required:!0,type:"string",enum:["list","detail"],message:"ac \u53C3\u6578\u5FC5\u9808\u70BA list \u6216 detail"},ids:{required:!1,type:"string",pattern:/^\d+(,\d+)*$/,message:"ids \u53C3\u6578\u683C\u5F0F\u932F\u8AA4\uFF0C\u61C9\u70BA\u6578\u5B57\u6216\u9017\u865F\u5206\u9694\u7684\u6578\u5B57\u5217\u8868"},pg:{required:!1,type:"number",min:1,max:1e4,message:"pg \u53C3\u6578\u5FC5\u9808\u70BA 1-10000 \u4E4B\u9593\u7684\u6574\u6578"},t:{required:!1,type:"number",min:1,max:99,message:"t \u53C3\u6578\u5FC5\u9808\u70BA 1-99 \u4E4B\u9593\u7684\u6574\u6578"},h:{required:!1,type:"number",min:1,max:8760,message:"h \u53C3\u6578\u5FC5\u9808\u70BA 1-8760 \u4E4B\u9593\u7684\u6574\u6578"},wd:{required:!1,type:"string",minLength:1,maxLength:100,message:"wd \u53C3\u6578\u9577\u5EA6\u5FC5\u9808\u70BA 1-100 \u5B57\u5143"},limit:{required:!1,type:"number",min:1,max:100,message:"limit \u53C3\u6578\u5FC5\u9808\u70BA 1-100 \u4E4B\u9593\u7684\u6574\u6578"},sort:{required:!1,type:"string",enum:["time","title","id","ep"],message:"sort \u53C3\u6578\u5FC5\u9808\u70BA time, title, id, ep \u4E4B\u4E00"},order:{required:!1,type:"string",enum:["asc","desc"],message:"order \u53C3\u6578\u5FC5\u9808\u70BA asc \u6216 desc"}}});var Se={};Ut(Se,{CATEGORY_MAPPING:()=>$,CMS10_VERSION:()=>Zr,Cms10Error:()=>E,DEFAULT_CONFIG:()=>Mt,ERROR_CODE_MAPPING:()=>ae,ErrorLogger:()=>q,ErrorMessages:()=>_t,ErrorStats:()=>st,ErrorTypes:()=>h,ValidationRules:()=>Ne,applyFilters:()=>ct,batchConvertItems:()=>nt,calculatePagination:()=>it,checkDataQuality:()=>lr,convertDetailResponse:()=>vt,convertListResponse:()=>X,convertPlayUrl:()=>pe,convertPremiereToYear:()=>he,convertTimestamp:()=>de,convertToDetailItem:()=>ye,convertToListItem:()=>Ot,createCms10Response:()=>at,createCms10Router:()=>xe,createDataConversionError:()=>ze,createDataNotFoundError:()=>B,createDetailedErrorResponse:()=>tr,createErrorResponse:()=>R,createMissingParameterError:()=>Xe,createNetworkError:()=>oe,createParameterError:()=>rt,createRateLimiter:()=>sr,createRouteConfig:()=>$t,createSuccessResponse:()=>Q,createSystemError:()=>G,createValidationError:()=>K,determineSerialStatus:()=>ge,errorStats:()=>wt,extractActors:()=>me,extractDataItems:()=>J,extractEpisodeNumber:()=>Ct,extractRequestContext:()=>ce,fetchWithRetry:()=>er,filterByCategory:()=>Ae,filterByIds:()=>we,filterByUpdateTime:()=>Ie,formatRemarks:()=>fe,generateRouteDocs:()=>yr,getAvailableCategories:()=>ir,getCategoryMapping:()=>ue,getCategoryStats:()=>ar,getCms10Categories:()=>Lt,getCms10Info:()=>xt,getLocalizedErrorMessage:()=>Ze,handleCms10Category:()=>mr,handleCms10Detail:()=>De,handleCms10List:()=>ut,handleCms10Request:()=>Dt,handleCms10Search:()=>gr,healthCheck:()=>bt,integrateCms10Routes:()=>Pt,mapErrorToCms10:()=>Y,mergeDataSources:()=>z,paginateData:()=>ot,processCategoryRequest:()=>cr,processSearchRequest:()=>or,searchByKeyword:()=>_e,sortItems:()=>Ce,validateBusinessLogic:()=>Me,validateCms10Item:()=>Ee,validateCms10Response:()=>Re,validateFullQuery:()=>lt,validateIds:()=>dr,validatePagination:()=>hr,validateParameter:()=>Te,validateQuery:()=>ve,validateRouteConfig:()=>Er,validateSearchKeyword:()=>pr,withErrorHandling:()=>P,withFallback:()=>rr});var Zr,Mt,St=A(()=>{Nt();Tt();Oe();ur();It();fr();le();Le();be();Zr={version:"1.0.0",buildDate:"2025-07-26",description:"Myself-BBS to CMS10 Conversion Module"},Mt={baseUrl:"https://myself-bbs.jacob.workers.dev",defaultLimit:20,maxLimit:100,timezone:"Asia/Taipei"}});async function ut(e){try{let t=lt(e);if(!t.isValid){let l=[...t.errors,...t.businessErrors];throw K(l)}let r=t.params,[s,n]=await Promise.all([U().catch(l=>(console.warn("\u7372\u53D6\u9023\u8F09\u5217\u8868\u5931\u6557:",l.message),{data:{data:[]}})),V().catch(l=>(console.warn("\u7372\u53D6\u5B8C\u7D50\u5217\u8868\u5931\u6557:",l.message),{data:{data:[]}}))]),i=J(s),a=J(n);if(i.length===0&&a.length===0)throw B("anime_list","all");let o=z([s,n]);if(o.length===0)throw B("anime","any");let c=X({data:{data:o}},r,{baseUrl:Mt.baseUrl});return m({data:JSON.stringify(c,null,2)})}catch(t){throw t}}async function De(e){try{let t=lt(e);if(!t.isValid){let l=[...t.errors,...t.businessErrors];throw K(l)}let r=t.params,n=r.ids.split(",").map(l=>parseInt(l.trim())).filter(l=>!isNaN(l)&&l>0);if(n.length===0)throw B("anime","invalid_ids");let i=n.map(async l=>{try{return await ft(l)}catch(u){return console.warn(`\u7372\u53D6\u52D5\u756B\u8A73\u60C5\u5931\u6557 (ID: ${l}):`,u.message),null}}),o=(await Promise.all(i)).filter(l=>l!==null);if(o.length===0)throw B("anime_details",n.join(","));let c=vt(o,r,{baseUrl:Mt.baseUrl});return m({data:JSON.stringify(c,null,2)})}catch(t){throw t}}async function gr(e){return await ut(e)}async function mr(e){return await ut(e)}async function Dt(e){try{if(!e.ac)throw K(["\u7F3A\u5C11\u5FC5\u8981\u53C3\u6578\uFF1Aac"]);switch(e.ac){case"list":return await ut(e);case"detail":return await De(e);default:throw K([`\u4E0D\u652F\u63F4\u7684\u64CD\u4F5C\u985E\u578B\uFF1A${e.ac}`])}}catch(t){throw t}}async function Lt(){try{let{getAvailableCategories:e}=await Promise.resolve().then(()=>(St(),Se)),t=e(),r={code:1,msg:"\u5206\u985E\u5217\u8868",page:1,pagecount:1,limit:t.length.toString(),total:t.length,list:t};return m({data:JSON.stringify(r,null,2)})}catch(e){throw G("\u7372\u53D6\u5206\u985E\u5217\u8868\u5931\u6557",e)}}async function xt(){try{let{CMS10_VERSION:e}=await Promise.resolve().then(()=>(St(),Se)),t={name:"Myself-BBS CMS10 API",version:e.version,buildDate:e.buildDate,description:e.description,endpoints:{list:"/api.php/provide/vod/?ac=list",detail:"/api.php/provide/vod/?ac=detail&ids={ids}",search:"/api.php/provide/vod/?ac=list&wd={keyword}",category:"/api.php/provide/vod/?ac=list&t={type_id}"},parameters:{ac:"\u64CD\u4F5C\u985E\u578B (list|detail)",ids:"ID\u5217\u8868\uFF0C\u9017\u865F\u5206\u9694 (detail\u6642\u5FC5\u8981)",pg:"\u9801\u78BC\uFF0C\u9810\u8A2D1",limit:"\u6BCF\u9801\u6578\u91CF\uFF0C\u9810\u8A2D20\uFF0C\u6700\u5927100",t:"\u5206\u985EID\uFF0C1-99",wd:"\u641C\u5C0B\u95DC\u9375\u5B57",h:"\u66F4\u65B0\u6642\u9593\u7BE9\u9078\uFF0C\u5C0F\u6642\u6578"}},r={code:1,msg:"API\u8CC7\u8A0A",page:1,pagecount:1,limit:"1",total:1,list:[t]};return m({data:JSON.stringify(r,null,2)})}catch(e){throw G("\u7372\u53D6API\u8CC7\u8A0A\u5931\u6557",e)}}async function bt(){try{let e=Date.now(),t=[U().then(()=>!0).catch(()=>!1),V().then(()=>!0).catch(()=>!1)],[r,s]=await Promise.all(t),n=Date.now()-e,i={status:"healthy",timestamp:new Date().toISOString(),responseTime:`${n}ms`,services:{airing_list:r?"ok":"error",completed_list:s?"ok":"error"},version:"1.0.0"},a={code:1,msg:"\u5065\u5EB7\u6AA2\u67E5",page:1,pagecount:1,limit:"1",total:1,list:[i]};return m({data:JSON.stringify(a,null,2)})}catch(e){throw G("\u5065\u5EB7\u6AA2\u67E5\u5931\u6557",e)}}var Le=A(()=>{gt();Bt();tt();St()});function xe(){let e=pt();return e.get("/api.php/provide/vod/",P(async t=>{let{query:r}=t;return await Dt(r)})),e.get("/api.php/provide/vod/categories",P(async t=>await Lt())),e.get("/api.php/provide/vod/info",P(async t=>await xt())),e.get("/api.php/provide/vod/health",P(async t=>await bt())),e.all("/api.php/*",P(async t=>{let{createErrorResponse:r}=await Promise.resolve().then(()=>(Tt(),nr)),s=r(-1,`\u4E0D\u652F\u63F4\u7684 CMS10 \u7AEF\u9EDE: ${new URL(t.url).pathname}`),{response:n}=await Promise.resolve().then(()=>(tt(),Fe));return n({data:JSON.stringify(s,null,2)})})),e}function Pt(e){let t=xe();return e.all("/api.php/*",t.handle),e}function $t(){return{legacy:{endpoints:[{path:"/list",description:"\u5217\u8868\u7D22\u5F15"},{path:"/list/completed",description:"\u5B8C\u7D50\u5217\u8868"},{path:"/list/airing",description:"\u9023\u8F09\u5217\u8868"},{path:"/anime/all",description:"\u6240\u6709\u52D5\u756B"},{path:"/anime/:id",description:"\u52D5\u756B\u8A73\u60C5"},{path:"/m3u8/:id/:ep",description:"\u64AD\u653E\u5730\u5740"},{path:"/search/:query",description:"\u641C\u5C0B"}]},cms10:{endpoints:[{path:"/api.php/provide/vod/?ac=list",description:"CMS10 \u5217\u8868 API",parameters:[{name:"ac",required:!0,description:"\u64CD\u4F5C\u985E\u578B (list)"},{name:"pg",required:!1,description:"\u9801\u78BC"},{name:"limit",required:!1,description:"\u6BCF\u9801\u6578\u91CF"},{name:"t",required:!1,description:"\u5206\u985E ID"},{name:"wd",required:!1,description:"\u641C\u5C0B\u95DC\u9375\u5B57"},{name:"h",required:!1,description:"\u66F4\u65B0\u6642\u9593\u7BE9\u9078"}]},{path:"/api.php/provide/vod/?ac=detail",description:"CMS10 \u8A73\u60C5 API",parameters:[{name:"ac",required:!0,description:"\u64CD\u4F5C\u985E\u578B (detail)"},{name:"ids",required:!0,description:"ID \u5217\u8868\uFF0C\u9017\u865F\u5206\u9694"},{name:"h",required:!1,description:"\u66F4\u65B0\u6642\u9593\u7BE9\u9078"}]},{path:"/api.php/provide/vod/categories",description:"\u5206\u985E\u5217\u8868 (\u64F4\u5C55)",parameters:[]},{path:"/api.php/provide/vod/info",description:"API \u8CC7\u8A0A (\u64F4\u5C55)",parameters:[]},{path:"/api.php/provide/vod/health",description:"\u5065\u5EB7\u6AA2\u67E5 (\u64F4\u5C55)",parameters:[]}]}}}function yr(){let e=$t();return{title:"Myself-BBS API \u8DEF\u7531\u6587\u4EF6",version:"1.0.0",description:"\u5305\u542B\u539F\u6709 API \u548C\u65B0\u589E CMS10 \u76F8\u5BB9 API \u7684\u5B8C\u6574\u8DEF\u7531\u6587\u4EF6",baseUrl:"https://myself-bbs.jacob.workers.dev",sections:[{title:"\u539F\u6709 API \u7AEF\u9EDE",description:"\u4FDD\u6301\u5411\u5F8C\u76F8\u5BB9\u7684\u539F\u6709 API \u7AEF\u9EDE",endpoints:e.legacy.endpoints.map(t=>({...t,fullUrl:`https://myself-bbs.jacob.workers.dev${t.path}`,method:"GET"}))},{title:"CMS10 \u76F8\u5BB9 API \u7AEF\u9EDE",description:"\u7B26\u5408 CMS10 \u6A19\u6E96\u7684\u65B0 API \u7AEF\u9EDE",endpoints:e.cms10.endpoints.map(t=>({...t,fullUrl:`https://myself-bbs.jacob.workers.dev${t.path}`,method:"GET"}))}],examples:{legacy:[{title:"\u7372\u53D6\u9023\u8F09\u5217\u8868",url:"/list/airing",description:"\u7372\u53D6\u6240\u6709\u9023\u8F09\u4E2D\u7684\u52D5\u756B\u5217\u8868"},{title:"\u641C\u5C0B\u52D5\u756B",url:"/search/\u9032\u64CA\u7684\u5DE8\u4EBA",description:"\u641C\u5C0B\u5305\u542B\u95DC\u9375\u5B57\u7684\u52D5\u756B"}],cms10:[{title:"CMS10 \u5217\u8868\u67E5\u8A62",url:"/api.php/provide/vod/?ac=list&pg=1&limit=20",description:"\u7372\u53D6\u7B2C\u4E00\u9801\u7684\u52D5\u756B\u5217\u8868\uFF0C\u6BCF\u980120\u9805"},{title:"CMS10 \u5206\u985E\u67E5\u8A62",url:"/api.php/provide/vod/?ac=list&t=1&pg=1",description:"\u7372\u53D6\u52D5\u4F5C\u5206\u985E\u7684\u52D5\u756B\u5217\u8868"},{title:"CMS10 \u641C\u5C0B\u67E5\u8A62",url:"/api.php/provide/vod/?ac=list&wd=\u5DE8\u4EBA&pg=1",description:"\u641C\u5C0B\u5305\u542B'\u5DE8\u4EBA'\u95DC\u9375\u5B57\u7684\u52D5\u756B"},{title:"CMS10 \u8A73\u60C5\u67E5\u8A62",url:"/api.php/provide/vod/?ac=detail&ids=1,2,3",description:"\u7372\u53D6\u6307\u5B9A ID \u7684\u52D5\u756B\u8A73\u60C5"}]}}}function Er(){let e=$t(),t=[],r=[],s=[...e.legacy.endpoints.map(i=>i.path),...e.cms10.endpoints.map(i=>i.path)],n=s.filter((i,a)=>s.indexOf(i)!==a);return n.length>0&&t.push(`\u91CD\u8907\u7684\u8DEF\u7531\u8DEF\u5F91: ${n.join(", ")}`),e.cms10.endpoints.forEach(i=>{let a=i.parameters?.filter(o=>o.required)||[];i.path.includes("ac=detail")&&!a.some(o=>o.name==="ids")&&r.push(`\u7AEF\u9EDE ${i.path} \u7F3A\u5C11\u5FC5\u8981\u53C3\u6578 ids \u7684\u5B9A\u7FA9`)}),{isValid:t.length===0,errors:t,warnings:r,summary:{totalEndpoints:s.length,legacyEndpoints:e.legacy.endpoints.length,cms10Endpoints:e.cms10.endpoints.length}}}var be=A(()=>{Vt();le();Le()});Vt();Bt();Z();gt();tt();function M(e){return Array.isArray?Array.isArray(e):Ke(e)==="[object Array]"}var _r=1/0;function Ir(e){if(typeof e=="string")return e;let t=e+"";return t=="0"&&1/e==-_r?"-0":t}function wr(e){return e==null?"":Ir(e)}function O(e){return typeof e=="string"}function qe(e){return typeof e=="number"}function Cr(e){return e===!0||e===!1||Or(e)&&Ke(e)=="[object Boolean]"}function Je(e){return typeof e=="object"}function Or(e){return Je(e)&&e!==null}function _(e){return e!=null}function Jt(e){return!e.trim().length}function Ke(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}var Nr="Incorrect 'index' type",Tr=e=>`Invalid value for key ${e}`,vr=e=>`Pattern length exceeds max of ${e}.`,Mr=e=>`Missing ${e} property in key`,Sr=e=>`Property 'weight' in key '${e}' must be a positive integer`,Ue=Object.prototype.hasOwnProperty,Kt=class{constructor(t){this._keys=[],this._keyMap={};let r=0;t.forEach(s=>{let n=We(s);r+=n.weight,this._keys.push(n),this._keyMap[n.id]=n,r+=n.weight}),this._keys.forEach(s=>{s.weight/=r})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function We(e){let t=null,r=null,s=null,n=1,i=null;if(O(e)||M(e))s=e,t=Ve(e),r=Wt(e);else{if(!Ue.call(e,"name"))throw new Error(Mr("name"));let a=e.name;if(s=a,Ue.call(e,"weight")&&(n=e.weight,n<=0))throw new Error(Sr(a));t=Ve(a),r=Wt(a),i=e.getFn}return{path:t,id:r,weight:n,src:s,getFn:i}}function Ve(e){return M(e)?e:e.split(".")}function Wt(e){return M(e)?e.join("."):e}function Dr(e,t){let r=[],s=!1,n=(i,a,o)=>{if(!!_(i))if(!a[o])r.push(i);else{let c=a[o],l=i[c];if(!_(l))return;if(o===a.length-1&&(O(l)||qe(l)||Cr(l)))r.push(wr(l));else if(M(l)){s=!0;for(let u=0,p=l.length;u<p;u+=1)n(l[u],a,o+1)}else a.length&&n(l,a,o+1)}};return n(e,O(t)?t.split("."):t,0),s?r:r[0]}var Lr={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},xr={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},br={location:0,threshold:.6,distance:100},Pr={useExtendedSearch:!1,getFn:Dr,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},d={...xr,...Lr,...br,...Pr},$r=/[^ ]+/g;function kr(e=1,t=3){let r=new Map,s=Math.pow(10,t);return{get(n){let i=n.match($r).length;if(r.has(i))return r.get(i);let a=1/Math.pow(i,.5*e),o=parseFloat(Math.round(a*s)/s);return r.set(i,o),o},clear(){r.clear()}}}var et=class{constructor({getFn:t=d.getFn,fieldNormWeight:r=d.fieldNormWeight}={}){this.norm=kr(r,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((r,s)=>{this._keysMap[r.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,O(this.docs[0])?this.docs.forEach((t,r)=>{this._addString(t,r)}):this.docs.forEach((t,r)=>{this._addObject(t,r)}),this.norm.clear())}add(t){let r=this.size();O(t)?this._addString(t,r):this._addObject(t,r)}removeAt(t){this.records.splice(t,1);for(let r=t,s=this.size();r<s;r+=1)this.records[r].i-=1}getValueForItemAtKeyId(t,r){return t[this._keysMap[r]]}size(){return this.records.length}_addString(t,r){if(!_(t)||Jt(t))return;let s={v:t,i:r,n:this.norm.get(t)};this.records.push(s)}_addObject(t,r){let s={i:r,$:{}};this.keys.forEach((n,i)=>{let a=n.getFn?n.getFn(t):this.getFn(t,n.path);if(!!_(a)){if(M(a)){let o=[],c=[{nestedArrIndex:-1,value:a}];for(;c.length;){let{nestedArrIndex:l,value:u}=c.pop();if(!!_(u))if(O(u)&&!Jt(u)){let p={v:u,i:l,n:this.norm.get(u)};o.push(p)}else M(u)&&u.forEach((p,f)=>{c.push({nestedArrIndex:f,value:p})})}s.$[i]=o}else if(O(a)&&!Jt(a)){let o={v:a,n:this.norm.get(a)};s.$[i]=o}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}};function He(e,t,{getFn:r=d.getFn,fieldNormWeight:s=d.fieldNormWeight}={}){let n=new et({getFn:r,fieldNormWeight:s});return n.setKeys(e.map(We)),n.setSources(t),n.create(),n}function Fr(e,{getFn:t=d.getFn,fieldNormWeight:r=d.fieldNormWeight}={}){let{keys:s,records:n}=e,i=new et({getFn:t,fieldNormWeight:r});return i.setKeys(s),i.setIndexRecords(n),i}function mt(e,{errors:t=0,currentLocation:r=0,expectedLocation:s=0,distance:n=d.distance,ignoreLocation:i=d.ignoreLocation}={}){let a=t/e.length;if(i)return a;let o=Math.abs(s-r);return n?a+o/n:o?1:a}function Ur(e=[],t=d.minMatchCharLength){let r=[],s=-1,n=-1,i=0;for(let a=e.length;i<a;i+=1){let o=e[i];o&&s===-1?s=i:!o&&s!==-1&&(n=i-1,n-s+1>=t&&r.push([s,n]),s=-1)}return e[i-1]&&i-s>=t&&r.push([s,i-1]),r}var j=32;function Vr(e,t,r,{location:s=d.location,distance:n=d.distance,threshold:i=d.threshold,findAllMatches:a=d.findAllMatches,minMatchCharLength:o=d.minMatchCharLength,includeMatches:c=d.includeMatches,ignoreLocation:l=d.ignoreLocation}={}){if(t.length>j)throw new Error(vr(j));let u=t.length,p=e.length,f=Math.max(0,Math.min(s,p)),g=i,y=f,I=o>1||c,k=I?Array(p):[],v;for(;(v=e.indexOf(t,y))>-1;){let w=mt(t,{currentLocation:v,expectedLocation:f,distance:n,ignoreLocation:l});if(g=Math.min(w,g),y=v+u,I){let D=0;for(;D<u;)k[v+D]=1,D+=1}}y=-1;let W=[],F=1,dt=u+p,Rr=1<<u-1;for(let w=0;w<u;w+=1){let D=0,L=dt;for(;D<L;)mt(t,{errors:w,currentLocation:f+L,expectedLocation:f,distance:n,ignoreLocation:l})<=g?D=L:dt=L,L=Math.floor((dt-D)/2+D);dt=L;let Pe=Math.max(1,f-L+1),Ft=a?p:Math.min(f+L,p)+u,H=Array(Ft+2);H[Ft+1]=(1<<w)-1;for(let C=Ft;C>=Pe;C-=1){let ht=C-1,$e=r[e.charAt(ht)];if(I&&(k[ht]=+!!$e),H[C]=(H[C+1]<<1|1)&$e,w&&(H[C]|=(W[C+1]|W[C])<<1|1|W[C+1]),H[C]&Rr&&(F=mt(t,{errors:w,currentLocation:ht,expectedLocation:f,distance:n,ignoreLocation:l}),F<=g)){if(g=F,y=ht,y<=f)break;Pe=Math.max(1,2*f-y)}}if(mt(t,{errors:w+1,currentLocation:f,expectedLocation:f,distance:n,ignoreLocation:l})>g)break;W=H}let kt={isMatch:y>=0,score:Math.max(.001,F)};if(I){let w=Ur(k,o);w.length?c&&(kt.indices=w):kt.isMatch=!1}return kt}function jr(e){let t={};for(let r=0,s=e.length;r<s;r+=1){let n=e.charAt(r);t[n]=(t[n]||0)|1<<s-r-1}return t}var yt=class{constructor(t,{location:r=d.location,threshold:s=d.threshold,distance:n=d.distance,includeMatches:i=d.includeMatches,findAllMatches:a=d.findAllMatches,minMatchCharLength:o=d.minMatchCharLength,isCaseSensitive:c=d.isCaseSensitive,ignoreLocation:l=d.ignoreLocation}={}){if(this.options={location:r,threshold:s,distance:n,includeMatches:i,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:c,ignoreLocation:l},this.pattern=c?t:t.toLowerCase(),this.chunks=[],!this.pattern.length)return;let u=(f,g)=>{this.chunks.push({pattern:f,alphabet:jr(f),startIndex:g})},p=this.pattern.length;if(p>j){let f=0,g=p%j,y=p-g;for(;f<y;)u(this.pattern.substr(f,j),f),f+=j;if(g){let I=p-j;u(this.pattern.substr(I),I)}}else u(this.pattern,0)}searchIn(t){let{isCaseSensitive:r,includeMatches:s}=this.options;if(r||(t=t.toLowerCase()),this.pattern===t){let y={isMatch:!0,score:0};return s&&(y.indices=[[0,t.length-1]]),y}let{location:n,distance:i,threshold:a,findAllMatches:o,minMatchCharLength:c,ignoreLocation:l}=this.options,u=[],p=0,f=!1;this.chunks.forEach(({pattern:y,alphabet:I,startIndex:k})=>{let{isMatch:v,score:W,indices:F}=Vr(t,y,I,{location:n+k,distance:i,threshold:a,findAllMatches:o,minMatchCharLength:c,includeMatches:s,ignoreLocation:l});v&&(f=!0),p+=W,v&&F&&(u=[...u,...F])});let g={isMatch:f,score:f?p/this.chunks.length:1};return f&&s&&(g.indices=u),g}},N=class{constructor(t){this.pattern=t}static isMultiMatch(t){return je(t,this.multiRegex)}static isSingleMatch(t){return je(t,this.singleRegex)}search(){}};function je(e,t){let r=e.match(t);return r?r[1]:null}var Ht=class extends N{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){let r=t===this.pattern;return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}},Yt=class extends N{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){let s=t.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,t.length-1]}}},Qt=class extends N{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){let r=t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}},Xt=class extends N{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){let r=!t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}},zt=class extends N{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){let r=t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[t.length-this.pattern.length,t.length-1]}}},Zt=class extends N{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){let r=!t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}},Et=class extends N{constructor(t,{location:r=d.location,threshold:s=d.threshold,distance:n=d.distance,includeMatches:i=d.includeMatches,findAllMatches:a=d.findAllMatches,minMatchCharLength:o=d.minMatchCharLength,isCaseSensitive:c=d.isCaseSensitive,ignoreLocation:l=d.ignoreLocation}={}){super(t),this._bitapSearch=new yt(t,{location:r,threshold:s,distance:n,includeMatches:i,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:c,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}},Rt=class extends N{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let r=0,s,n=[],i=this.pattern.length;for(;(s=t.indexOf(this.pattern,r))>-1;)r=s+i,n.push([s,r-1]);let a=!!n.length;return{isMatch:a,score:a?0:1,indices:n}}},te=[Ht,Rt,Qt,Xt,Zt,zt,Yt,Et],Be=te.length,Br=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Gr="|";function qr(e,t={}){return e.split(Gr).map(r=>{let s=r.trim().split(Br).filter(i=>i&&!!i.trim()),n=[];for(let i=0,a=s.length;i<a;i+=1){let o=s[i],c=!1,l=-1;for(;!c&&++l<Be;){let u=te[l],p=u.isMultiMatch(o);p&&(n.push(new u(p,t)),c=!0)}if(!c)for(l=-1;++l<Be;){let u=te[l],p=u.isSingleMatch(o);if(p){n.push(new u(p,t));break}}}return n})}var Jr=new Set([Et.type,Rt.type]),ee=class{constructor(t,{isCaseSensitive:r=d.isCaseSensitive,includeMatches:s=d.includeMatches,minMatchCharLength:n=d.minMatchCharLength,ignoreLocation:i=d.ignoreLocation,findAllMatches:a=d.findAllMatches,location:o=d.location,threshold:c=d.threshold,distance:l=d.distance}={}){this.query=null,this.options={isCaseSensitive:r,includeMatches:s,minMatchCharLength:n,findAllMatches:a,ignoreLocation:i,location:o,threshold:c,distance:l},this.pattern=r?t:t.toLowerCase(),this.query=qr(this.pattern,this.options)}static condition(t,r){return r.useExtendedSearch}searchIn(t){let r=this.query;if(!r)return{isMatch:!1,score:1};let{includeMatches:s,isCaseSensitive:n}=this.options;t=n?t:t.toLowerCase();let i=0,a=[],o=0;for(let c=0,l=r.length;c<l;c+=1){let u=r[c];a.length=0,i=0;for(let p=0,f=u.length;p<f;p+=1){let g=u[p],{isMatch:y,indices:I,score:k}=g.search(t);if(y){if(i+=1,o+=k,s){let v=g.constructor.type;Jr.has(v)?a=[...a,...I]:a.push(I)}}else{o=0,i=0,a.length=0;break}}if(i){let p={isMatch:!0,score:o/i};return s&&(p.indices=a),p}}return{isMatch:!1,score:1}}},re=[];function Kr(...e){re.push(...e)}function se(e,t){for(let r=0,s=re.length;r<s;r+=1){let n=re[r];if(n.condition(e,t))return new n(e,t)}return new yt(e,t)}var At={AND:"$and",OR:"$or"},ne={PATH:"$path",PATTERN:"$val"},ie=e=>!!(e[At.AND]||e[At.OR]),Wr=e=>!!e[ne.PATH],Hr=e=>!M(e)&&Je(e)&&!ie(e),Ge=e=>({[At.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function Ye(e,t,{auto:r=!0}={}){let s=n=>{let i=Object.keys(n),a=Wr(n);if(!a&&i.length>1&&!ie(n))return s(Ge(n));if(Hr(n)){let c=a?n[ne.PATH]:i[0],l=a?n[ne.PATTERN]:n[c];if(!O(l))throw new Error(Tr(c));let u={keyId:Wt(c),pattern:l};return r&&(u.searcher=se(l,t)),u}let o={children:[],operator:i[0]};return i.forEach(c=>{let l=n[c];M(l)&&l.forEach(u=>{o.children.push(s(u))})}),o};return ie(e)||(e=Ge(e)),s(e)}function Yr(e,{ignoreFieldNorm:t=d.ignoreFieldNorm}){e.forEach(r=>{let s=1;r.matches.forEach(({key:n,norm:i,score:a})=>{let o=n?n.weight:null;s*=Math.pow(a===0&&o?Number.EPSILON:a,(o||1)*(t?1:i))}),r.score=s})}function Qr(e,t){let r=e.matches;t.matches=[],_(r)&&r.forEach(s=>{if(!_(s.indices)||!s.indices.length)return;let{indices:n,value:i}=s,a={indices:n,value:i};s.key&&(a.key=s.key.src),s.idx>-1&&(a.refIndex=s.idx),t.matches.push(a)})}function Xr(e,t){t.score=e.score}function zr(e,t,{includeMatches:r=d.includeMatches,includeScore:s=d.includeScore}={}){let n=[];return r&&n.push(Qr),s&&n.push(Xr),e.map(i=>{let{idx:a}=i,o={item:t[a],refIndex:a};return n.length&&n.forEach(c=>{c(i,o)}),o})}var S=class{constructor(t,r={},s){this.options={...d,...r},this.options.useExtendedSearch,this._keyStore=new Kt(this.options.keys),this.setCollection(t,s)}setCollection(t,r){if(this._docs=t,r&&!(r instanceof et))throw new Error(Nr);this._myIndex=r||He(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){!_(t)||(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){let r=[];for(let s=0,n=this._docs.length;s<n;s+=1){let i=this._docs[s];t(i,s)&&(this.removeAt(s),s-=1,n-=1,r.push(i))}return r}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:r=-1}={}){let{includeMatches:s,includeScore:n,shouldSort:i,sortFn:a,ignoreFieldNorm:o}=this.options,c=O(t)?O(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return Yr(c,{ignoreFieldNorm:o}),i&&c.sort(a),qe(r)&&r>-1&&(c=c.slice(0,r)),zr(c,this._docs,{includeMatches:s,includeScore:n})}_searchStringList(t){let r=se(t,this.options),{records:s}=this._myIndex,n=[];return s.forEach(({v:i,i:a,n:o})=>{if(!_(i))return;let{isMatch:c,score:l,indices:u}=r.searchIn(i);c&&n.push({item:i,idx:a,matches:[{score:l,value:i,norm:o,indices:u}]})}),n}_searchLogical(t){let r=Ye(t,this.options),s=(o,c,l)=>{if(!o.children){let{keyId:p,searcher:f}=o,g=this._findMatches({key:this._keyStore.get(p),value:this._myIndex.getValueForItemAtKeyId(c,p),searcher:f});return g&&g.length?[{idx:l,item:c,matches:g}]:[]}let u=[];for(let p=0,f=o.children.length;p<f;p+=1){let g=o.children[p],y=s(g,c,l);if(y.length)u.push(...y);else if(o.operator===At.AND)return[]}return u},n=this._myIndex.records,i={},a=[];return n.forEach(({$:o,i:c})=>{if(_(o)){let l=s(r,o,c);l.length&&(i[c]||(i[c]={idx:c,item:o,matches:[]},a.push(i[c])),l.forEach(({matches:u})=>{i[c].matches.push(...u)}))}}),a}_searchObjectList(t){let r=se(t,this.options),{keys:s,records:n}=this._myIndex,i=[];return n.forEach(({$:a,i:o})=>{if(!_(a))return;let c=[];s.forEach((l,u)=>{c.push(...this._findMatches({key:l,value:a[u],searcher:r}))}),c.length&&i.push({idx:o,item:a,matches:c})}),i}_findMatches({key:t,value:r,searcher:s}){if(!_(r))return[];let n=[];if(M(r))r.forEach(({v:i,i:a,n:o})=>{if(!_(i))return;let{isMatch:c,score:l,indices:u}=s.searchIn(i);c&&n.push({score:l,key:t,value:i,idx:a,norm:o,indices:u})});else{let{v:i,n:a}=r,{isMatch:o,score:c,indices:l}=s.searchIn(i);o&&n.push({score:c,key:t,value:i,norm:a,indices:l})}return n}};S.version="6.6.2";S.createIndex=He;S.parseIndex=Fr;S.config=d;S.parseQuery=Ye;Kr(ee);gt();async function Qe(e){let t=[...(await U()).data,...(await V()).data],r={includeScore:!0,keys:["title"]};return new S(t,r).search(e).map(i=>i.item)}be();var T=pt();Pt(T);T.get("/list",async e=>{let{query:t,url:r}=e,s=new URL(r).origin,n={completed:s+"/list/completed",airing:s+"/list/airing"};return m({data:JSON.stringify({data:n},null,t.min?0:2)})});T.get("/list/completed",async e=>{let{query:t}=e,r=await V();return m({data:JSON.stringify({data:r},null,t.min?0:2)})});T.get("/list/airing",async e=>{let{query:t}=e,r=await U();return m({data:JSON.stringify({data:r},null,t.min?0:2)})});T.get("/anime/all",async e=>{let{query:t}=e,r=await fetch(`${x}details.json`).then(s=>s.json());return m({data:JSON.stringify({data:r},null,t.min?0:2)})});T.get("/anime/:id",async e=>{let{query:t,params:r}=e,s=await ft(r.id);return m({data:JSON.stringify({data:s},null,t.min?0:2)})});T.get("/m3u8/:id/:ep",async e=>{let{query:t,params:r}=e,s=await ke(r.id,r.ep);return m({data:JSON.stringify({data:s},null,t.min?0:2)})});T.get("/search/:query",async e=>{let{query:t,params:r}=e,s=await Qe(decodeURIComponent(r.query));return m({data:JSON.stringify({data:s},null,t.min?0:2)})});T.all("*",async e=>{let{query:t}=e;return m({data:JSON.stringify({error:"Unknown Request"},null,t.min?0:2)})});var Zs={async fetch(e,t,r){try{return await T.handle(e)}catch(s){return console.error(s),m({data:JSON.stringify({error:s.message},null,2)})}},async scheduled(e,t,r){}};export{Zs as default};
