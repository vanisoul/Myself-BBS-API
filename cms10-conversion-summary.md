# Myself-BBS API è½‰æ›ç‚º CMS10 è¦æ ¼ - ç¸½çµå ±å‘Š

## è¦æ ¼ç•°å‹•æ—¥æœŸæ™‚é–“

**å»ºç«‹æ—¥æœŸ**: 2025-07-26 15:38:00 (UTC+8)
**ç‰ˆæœ¬**: v1.0
**å°ˆæ¡ˆç‹€æ…‹**: è¦åŠƒå®Œæˆï¼Œæº–å‚™é€²å…¥å¯¦ä½œéšæ®µ

## 1. å°ˆæ¡ˆæ¦‚è¦½

### 1.1 ç›®æ¨™

å°‡ç¾æœ‰çš„ Myself-BBS API è½‰æ›ç‚ºç¬¦åˆ CMS10 æ¨™æº–çš„å½±ç‰‡ APIï¼Œæä¾›æ¨™æº–åŒ–çš„è¦–é »é»æ’­æœå‹™ä»‹é¢ã€‚

### 1.2 æ ¸å¿ƒéœ€æ±‚

- ä¿æŒå‘å¾Œç›¸å®¹æ€§ï¼ŒåŸæœ‰ API ç«¯é»ç¹¼çºŒé‹ä½œ
- æ–°å¢ CMS10 æ¨™æº–ç›¸å®¹çš„ API ç«¯é»
- å¯¦ç¾è³‡æ–™æ ¼å¼çš„ç„¡ç¸«è½‰æ›
- æä¾›å®Œæ•´çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

## 2. æŠ€è¡“æ¶æ§‹è¨­è¨ˆ

### 2.1 API ç«¯é»æ¶æ§‹

```
ç¾æœ‰ç«¯é» (ä¿ç•™)                    æ–°å¢ CMS10 ç«¯é»
â”œâ”€â”€ /list/airing                  â”œâ”€â”€ /api.php/provide/vod/?ac=videolist
â”œâ”€â”€ /list/completed               â”œâ”€â”€ /api.php/provide/vod/?ac=detail
â”œâ”€â”€ /anime/{id}                   â””â”€â”€ /api.php/provide/vod/?ac=videolist&wd={query}
â”œâ”€â”€ /anime/all
â”œâ”€â”€ /search/{query}
â””â”€â”€ /m3u8/{id}/{ep}
```

### 2.2 è³‡æ–™è½‰æ›æµç¨‹

```mermaid
graph TD
    A[åŸå§‹ Myself-BBS è³‡æ–™] --> B[è³‡æ–™é©—è­‰èˆ‡æ¸…ç†]
    B --> C[æ¬„ä½æ˜ å°„è½‰æ›]
    C --> D[åˆ†é¡ç³»çµ±å°æ‡‰]
    D --> E[æ™‚é–“æ ¼å¼è½‰æ›]
    E --> F[æ’­æ”¾åœ°å€æ ¼å¼åŒ–]
    F --> G[CMS10 æ¨™æº–å›æ‡‰]
    G --> H[éŒ¯èª¤è™•ç†åŒ…è£]
    H --> I[æœ€çµ‚ API å›æ‡‰]
```

## 3. é—œéµè¨­è¨ˆæ±ºç­–

### 3.1 è³‡æ–™æ¬„ä½æ˜ å°„

| è½‰æ›é¡å‹ | Myself-BBS                         | CMS10      | è½‰æ›é‚è¼¯       |
| -------- | ---------------------------------- | ---------- | -------------- |
| åŸºæœ¬è³‡è¨Š | `id` â†’ `vod_id`                    | ç›´æ¥å°æ‡‰   | æ•¸å€¼è½‰æ›       |
| æ¨™é¡Œ     | `title` â†’ `vod_name`               | ç›´æ¥å°æ‡‰   | å­—ä¸²ä¿æŒ       |
| åˆ†é¡     | `category[]` â†’ `type_id/type_name` | æ˜ å°„è¡¨è½‰æ› | å–ç¬¬ä¸€å€‹åˆ†é¡   |
| æ™‚é–“     | `timestamp` â†’ `vod_time`           | æ ¼å¼è½‰æ›   | UTC+8 æ™‚å€     |
| æ’­æ”¾åœ°å€ | `episodes{}` â†’ `vod_play_url`      | æ ¼å¼é‡çµ„   | é›†æ•¸$åœ°å€#æ ¼å¼ |

### 3.2 åˆ†é¡ç³»çµ±è¨­è¨ˆ

å»ºç«‹äº†å®Œæ•´çš„åˆ†é¡æ˜ å°„è¡¨ï¼Œæ¶µè“‹å‹•ç•«å¸¸è¦‹åˆ†é¡ï¼š

- å‹•ä½œ (type_id: 1)
- å†’éšª (type_id: 2)
- ç§‘å¹» (type_id: 3)
- å¥‡å¹» (type_id: 4)
- æ—¥å¸¸ (type_id: 5)
- æˆ€æ„› (type_id: 6)
- å–œåŠ‡ (type_id: 7)
- åŠ‡æƒ… (type_id: 8)
- æ‡¸ç–‘ (type_id: 9)
- ææ€– (type_id: 10)
- å…¶ä»– (type_id: 99)

### 3.3 éŒ¯èª¤è™•ç†ç­–ç•¥

æ¡ç”¨ CMS10 æ¨™æº–éŒ¯èª¤ç¢¼ï¼š

- `1`: è«‹æ±‚æˆåŠŸ
- `0`: ç³»çµ±éŒ¯èª¤
- `-1`: åƒæ•¸éŒ¯èª¤
- `-2`: è³‡æ–™ä¸å­˜åœ¨

## 4. å¯¦ä½œè¦åŠƒ

### 4.1 é–‹ç™¼éšæ®µ

1. **ç¬¬ä¸€éšæ®µ**: æ ¸å¿ƒè½‰æ›å‡½å¼é–‹ç™¼

   - å¯¦ä½œè³‡æ–™æ¬„ä½æ˜ å°„å‡½å¼
   - å»ºç«‹åˆ†é¡æ˜ å°„é‚è¼¯
   - é–‹ç™¼æ™‚é–“å’Œæ’­æ”¾åœ°å€è½‰æ›

2. **ç¬¬äºŒéšæ®µ**: API ç«¯é»å¯¦ä½œ

   - æ–°å¢ CMS10 è·¯ç”±è™•ç†
   - æ•´åˆè½‰æ›å‡½å¼
   - å¯¦ä½œåˆ†é å’Œæœå°‹åŠŸèƒ½

3. **ç¬¬ä¸‰éšæ®µ**: éŒ¯èª¤è™•ç†å’Œé©—è­‰

   - å»ºç«‹åƒæ•¸é©—è­‰æ©Ÿåˆ¶
   - å¯¦ä½œéŒ¯èª¤è™•ç†ä¸­ä»‹è»Ÿé«”
   - å®Œå–„æ—¥èªŒè¨˜éŒ„

4. **ç¬¬å››éšæ®µ**: æ¸¬è©¦å’Œå„ªåŒ–
   - åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶
   - æ•ˆèƒ½èª¿å„ª
   - æ–‡ä»¶å®Œå–„

### 4.2 æŠ€è¡“å¯¦ä½œè¦é»

#### 4.2.1 è·¯ç”±æ•´åˆ

```javascript
// æ–°å¢ CMS10 ç›¸å®¹è·¯ç”±
router.get(
  "/api.php/provide/vod/",
  withErrorHandling(async (request) => {
    const { query } = request;
    const validation = validateQuery(query);

    if (!validation.isValid) {
      throw createParameterError("query", validation.errors.join("; "));
    }

    switch (validation.params.ac) {
      case "video":
        return await handleCms10List(validation.params);
      case "detail":
        return await handleCms10Detail(validation.params);
      default:
        throw createParameterError("ac", "ä¸æ”¯æ´çš„æ“ä½œé¡å‹");
    }
  }),
);
```

#### 4.2.2 è³‡æ–™è½‰æ›æ ¸å¿ƒ

```javascript
function convertListResponse(myselfData, query = {}, options = {}) {
  // 1. æå–å’Œç¯©é¸è³‡æ–™
  let items = myselfData?.data?.data || [];

  // 2. æ‡‰ç”¨ç¯©é¸æ¢ä»¶
  if (query.t) items = filterByCategory(items, query.t);
  if (query.wd) items = searchByKeyword(items, query.wd);
  if (query.h) items = filterByUpdateTime(items, query.h);

  // 3. åˆ†é è™•ç†
  const { data: paginatedData, pagination } = paginateData(items, query.pg, 20);

  // 4. è½‰æ›ç‚º CMS10 æ ¼å¼
  const cms10Items = batchConvertItems(paginatedData, "list", options);

  // 5. å»ºç«‹æ¨™æº–å›æ‡‰
  return createSuccessResponse(cms10Items, pagination);
}
```

## 5. å“è³ªä¿è­‰

### 5.1 æ¸¬è©¦ç­–ç•¥

- **å–®å…ƒæ¸¬è©¦**: è¦†è“‹æ‰€æœ‰è½‰æ›å‡½å¼å’Œå·¥å…·å‡½å¼
- **æ•´åˆæ¸¬è©¦**: é©—è­‰ API ç«¯é»å®Œæ•´æµç¨‹
- **ç›¸å®¹æ€§æ¸¬è©¦**: ç¢ºä¿ç¬¦åˆ CMS10 æ¨™æº–
- **å›æ­¸æ¸¬è©¦**: ä¿è­‰åŸæœ‰åŠŸèƒ½ä¸å—å½±éŸ¿

### 5.2 é©—æ”¶æ¨™æº–

- æ‰€æœ‰ CMS10 API ç«¯é»æ­£å¸¸é‹ä½œ
- è³‡æ–™è½‰æ›æº–ç¢ºç‡ 100%
- åŸæœ‰ API åŠŸèƒ½ä¿æŒä¸è®Š
- éŒ¯èª¤è™•ç†ç¬¦åˆè¦ç¯„
- æ¸¬è©¦è¦†è“‹ç‡ â‰¥ 80%

## 6. éƒ¨ç½²è¨ˆåŠƒ

### 6.1 éƒ¨ç½²ç­–ç•¥

1. **é–‹ç™¼ç’°å¢ƒ**: å®Œæ•´åŠŸèƒ½é–‹ç™¼å’Œæ¸¬è©¦
2. **æ¸¬è©¦ç’°å¢ƒ**: å®Œæ•´çš„ç›¸å®¹æ€§å’Œæ•ˆèƒ½æ¸¬è©¦
3. **é ç”Ÿç”¢ç’°å¢ƒ**: æœ€çµ‚é©—è­‰å’Œå£“åŠ›æ¸¬è©¦
4. **ç”Ÿç”¢ç’°å¢ƒ**: æ¼¸é€²å¼éƒ¨ç½²ï¼Œç›£æ§å›é¥‹

### 6.2 é¢¨éšªæ§åˆ¶

- ä¿ç•™åŸæœ‰ API ç«¯é»ï¼Œç¢ºä¿å‘å¾Œç›¸å®¹
- å¯¦ä½œåŠŸèƒ½é–‹é—œï¼Œå¯å¿«é€Ÿå›æ»¾
- å»ºç«‹å®Œæ•´çš„ç›£æ§å’Œå‘Šè­¦æ©Ÿåˆ¶
- æº–å‚™è©³ç´°çš„å›æ»¾è¨ˆåŠƒ

## 7. ç›£æ§å’Œç¶­è­·

### 7.1 é—œéµæŒ‡æ¨™

- API å›æ‡‰æ™‚é–“
- éŒ¯èª¤ç‡çµ±è¨ˆ
- è³‡æ–™è½‰æ›æº–ç¢ºæ€§
- ä½¿ç”¨é‡åˆ†æ

### 7.2 ç¶­è­·è¨ˆåŠƒ

- å®šæœŸæª¢æŸ¥è½‰æ›é‚è¼¯çš„æº–ç¢ºæ€§
- ç›£æ§æ–°å¢åˆ†é¡çš„éœ€æ±‚
- æŒçºŒå„ªåŒ–æ•ˆèƒ½
- æ›´æ–°æ–‡ä»¶å’Œæ¸¬è©¦

## 8. æ–‡ä»¶æ¸…å–®

æœ¬æ¬¡è¦åŠƒç”¢å‡ºçš„å®Œæ•´æ–‡ä»¶ï¼š

1. **[`cms10-conversion-analysis.md`](cms10-conversion-analysis.md)** - è½‰æ›åˆ†ææ–‡ä»¶

   - ç¾æœ‰ API è³‡æ–™çµæ§‹åˆ†æ
   - CMS10 è¦æ ¼è¦æ±‚åˆ†æ
   - è³‡æ–™çµæ§‹å°æ‡‰é—œä¿‚
   - é—œéµè½‰æ›æŒ‘æˆ°

2. **[`cms10-field-mapping.md`](cms10-field-mapping.md)** - æ¬„ä½æ˜ å°„è¡¨

   - è©³ç´°çš„æ¬„ä½å°æ‡‰é—œä¿‚
   - è½‰æ›å‡½å¼å¯¦ä½œ
   - åˆ†é¡ç³»çµ±æ˜ å°„
   - æ™‚é–“å’Œæ’­æ”¾åœ°å€è½‰æ›é‚è¼¯

3. **[`cms10-api-endpoints.md`](cms10-api-endpoints.md)** - API ç«¯é»è¦åŠƒ

   - æ–°å¢ç«¯é»çµæ§‹è¨­è¨ˆ
   - åƒæ•¸è™•ç†é‚è¼¯
   - è·¯ç”±æ•´åˆæ–¹æ¡ˆ
   - åˆ†é å’Œæœå°‹å¯¦ä½œ

4. **[`cms10-response-functions.md`](cms10-response-functions.md)** - å›æ‡‰æ ¼å¼å‡½å¼

   - æ¨™æº–åŒ–è½‰æ›å‡½å¼
   - æ‰¹é‡è™•ç†é‚è¼¯
   - è³‡æ–™é©—è­‰æ©Ÿåˆ¶
   - ä½¿ç”¨ç¯„ä¾‹

5. **[`cms10-error-handling.md`](cms10-error-handling.md)** - éŒ¯èª¤è™•ç†è¦åŠƒ

   - éŒ¯èª¤åˆ†é¡é«”ç³»
   - ç‹€æ…‹ç¢¼å°æ‡‰
   - åƒæ•¸é©—è­‰é‚è¼¯
   - éŒ¯èª¤ç›£æ§æ©Ÿåˆ¶

6. **[`cms10-testing-plan.md`](cms10-testing-plan.md)** - æ¸¬è©¦è¨ˆåŠƒ
   - å®Œæ•´æ¸¬è©¦ç­–ç•¥
   - å–®å…ƒå’Œæ•´åˆæ¸¬è©¦
   - ç›¸å®¹æ€§é©—è­‰
   - æ‰‹å‹•æ¸¬è©¦æ¸…å–®

## 9. ä¸‹ä¸€æ­¥è¡Œå‹•

### 9.1 ç«‹å³è¡Œå‹•é …ç›®

1. **ç’°å¢ƒæº–å‚™**: è¨­å®šé–‹ç™¼å’Œæ¸¬è©¦ç’°å¢ƒ
2. **ä¾è³´å®‰è£**: ç¢ºèªæ‰€éœ€çš„é–‹ç™¼å·¥å…·å’Œå‡½å¼åº«
3. **å°ˆæ¡ˆçµæ§‹**: å»ºç«‹æ–°çš„æª”æ¡ˆçµæ§‹å’Œæ¨¡çµ„çµ„ç¹”

### 9.2 é–‹ç™¼é †åºå»ºè­°

1. å…ˆå¯¦ä½œæ ¸å¿ƒè½‰æ›å‡½å¼ (cms10-response-functions.md)
2. å»ºç«‹éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ (cms10-error-handling.md)
3. å¯¦ä½œ API ç«¯é» (cms10-api-endpoints.md)
4. åŸ·è¡Œæ¸¬è©¦é©—è­‰ (cms10-testing-plan.md)

### 9.3 é—œéµé‡Œç¨‹ç¢‘

- **Week 1**: æ ¸å¿ƒè½‰æ›å‡½å¼å®Œæˆ
- **Week 2**: API ç«¯é»å¯¦ä½œå®Œæˆ
- **Week 3**: æ¸¬è©¦å’Œé™¤éŒ¯
- **Week 4**: éƒ¨ç½²å’Œä¸Šç·š

## 10. æˆåŠŸæ¨™æº–

### 10.1 æŠ€è¡“æ¨™æº–

- âœ… å®Œå…¨ç¬¦åˆ CMS10 API è¦æ ¼
- âœ… ä¿æŒ 100% å‘å¾Œç›¸å®¹æ€§
- âœ… è³‡æ–™è½‰æ›æº–ç¢ºç‡ 100%
- âœ… API å›æ‡‰æ™‚é–“ < 3 ç§’
- âœ… éŒ¯èª¤è™•ç†è¦†è“‹ç‡ 100%

### 10.2 æ¥­å‹™æ¨™æº–

- âœ… ç¾æœ‰ç”¨æˆ¶ç«¯ç„¡éœ€ä¿®æ”¹
- âœ… æ”¯æ´ CMS10 æ¨™æº–çš„æ–°ç”¨æˆ¶ç«¯
- âœ… æä¾›å®Œæ•´çš„ API æ–‡ä»¶
- âœ… å»ºç«‹ç›£æ§å’Œç¶­è­·æ©Ÿåˆ¶

## 11. çµè«–

æœ¬æ¬¡è¦åŠƒå·²å®Œæˆ Myself-BBS API è½‰æ›ç‚º CMS10 è¦æ ¼çš„å®Œæ•´æŠ€è¡“æ–¹æ¡ˆè¨­è¨ˆã€‚è¦åŠƒæ¶µè“‹äº†ï¼š

- **å®Œæ•´çš„æŠ€è¡“æ¶æ§‹**: å¾è³‡æ–™è½‰æ›åˆ° API ç«¯é»çš„å…¨é¢è¨­è¨ˆ
- **è©³ç´°çš„å¯¦ä½œæŒ‡å—**: åŒ…å«å…·é«”çš„ç¨‹å¼ç¢¼ç¯„ä¾‹å’Œå¯¦ä½œé‚è¼¯
- **å…¨é¢çš„å“è³ªä¿è­‰**: æ¸¬è©¦ç­–ç•¥å’Œé©—æ”¶æ¨™æº–
- **é¢¨éšªæ§åˆ¶æ©Ÿåˆ¶**: å‘å¾Œç›¸å®¹å’Œå›æ»¾æ–¹æ¡ˆ

æ‰€æœ‰è¦åŠƒæ–‡ä»¶å·²æº–å‚™å®Œæˆï¼Œå¯ä»¥ç›´æ¥é€²å…¥å¯¦ä½œéšæ®µã€‚å»ºè­°æŒ‰ç…§æ—¢å®šçš„é–‹ç™¼é †åºå’Œé‡Œç¨‹ç¢‘åŸ·è¡Œï¼Œç¢ºä¿å°ˆæ¡ˆé †åˆ©å®Œæˆã€‚

---

**å°ˆæ¡ˆç‹€æ…‹**: âœ… è¦åŠƒéšæ®µå®Œæˆ
**ä¸‹ä¸€éšæ®µ**: ğŸš€ æº–å‚™é€²å…¥å¯¦ä½œéšæ®µ
**é è¨ˆå®Œæˆæ™‚é–“**: 4 é€±å…§å®Œæˆé–‹ç™¼å’Œéƒ¨ç½²
