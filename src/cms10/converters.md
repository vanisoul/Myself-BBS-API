# CMS10 æ ¸å¿ƒè½‰æ›å‡½å¼å¯¦ä½œè¦æ ¼

## è¦æ ¼ç•°å‹•æ—¥æœŸæ™‚é–“
**å»ºç«‹æ—¥æœŸ**: 2025-07-26 15:44:00 (UTC+8)
**ç‰ˆæœ¬**: v1.0.0
**å¯¦ä½œç‹€æ…‹**: âœ… å·²å®Œæˆ

## 1. å¯¦ä½œæ¦‚è¦½

æœ¬æ¬¡å¯¦ä½œå®Œæˆäº† CMS10 è½‰æ›æ¨¡çµ„çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…å«ä»¥ä¸‹ä¸»è¦çµ„ä»¶ï¼š

### 1.1 æ¨¡çµ„çµæ§‹
```
src/cms10/
â”œâ”€â”€ converters.js    # è³‡æ–™è½‰æ›æ ¸å¿ƒå‡½å¼
â”œâ”€â”€ response.js      # å›æ‡‰æ ¼å¼æ¨™æº–åŒ–å‡½å¼
â”œâ”€â”€ filters.js       # ç¯©é¸å’Œæœå°‹åŠŸèƒ½
â”œâ”€â”€ processors.js    # å®Œæ•´è½‰æ›æµç¨‹è™•ç†å™¨
â”œâ”€â”€ index.js         # æ¨¡çµ„ä¸»è¦å…¥å£
â””â”€â”€ converters.md    # æœ¬è¦æ ¼æ–‡ä»¶
```

### 1.2 æ ¸å¿ƒåŠŸèƒ½
- âœ… è³‡æ–™æ¬„ä½æ˜ å°„è½‰æ›
- âœ… åˆ†é¡ç³»çµ±å°æ‡‰
- âœ… æ™‚é–“æ ¼å¼è½‰æ›
- âœ… æ’­æ”¾åœ°å€æ ¼å¼åŒ–
- âœ… CMS10 æ¨™æº–å›æ‡‰æ ¼å¼
- âœ… åˆ†é è™•ç†æ©Ÿåˆ¶
- âœ… ç¯©é¸å’Œæœå°‹åŠŸèƒ½
- âœ… å®Œæ•´è½‰æ›æµç¨‹

## 2. å¯¦ä½œè©³æƒ…

### 2.1 è³‡æ–™è½‰æ›å™¨ (converters.js)

#### 2.1.1 åˆ†é¡æ˜ å°„ç³»çµ±
```javascript
const CATEGORY_MAPPING = {
  "å‹•ä½œ": { type_id: 1, type_name: "å‹•ä½œ" },
  "å†’éšª": { type_id: 2, type_name: "å†’éšª" },
  "ç§‘å¹»": { type_id: 3, type_name: "ç§‘å¹»" },
  // ... å®Œæ•´çš„ 11 å€‹åˆ†é¡æ˜ å°„
};
```

**å¯¦ä½œç‰¹é»**:
- æ”¯æ´ 11 ç¨®å‹•ç•«åˆ†é¡
- è‡ªå‹•è™•ç†æœªçŸ¥åˆ†é¡ (é è¨­ç‚º"å…¶ä»–")
- å–ç¬¬ä¸€å€‹åˆ†é¡ä½œç‚ºä¸»åˆ†é¡

#### 2.1.2 æ™‚é–“è½‰æ›åŠŸèƒ½
```javascript
function convertTimestamp(timestamp)
function convertPremiereToYear(premiere)
```

**å¯¦ä½œç‰¹é»**:
- è‡ªå‹•è½‰æ›ç‚ºå°åŒ—æ™‚å€ (UTC+8)
- è™•ç†ç„¡æ•ˆæ™‚é–“æˆ³çš„å®¹éŒ¯æ©Ÿåˆ¶
- æ”¯æ´å¤šç¨®æ™‚é–“æ ¼å¼è¼¸å…¥

#### 2.1.3 æ’­æ”¾åœ°å€è½‰æ›
```javascript
function convertPlayUrl(episodes, vodId, baseUrl)
```

**å¯¦ä½œç‰¹é»**:
- æŒ‰é›†æ•¸é †åºè‡ªå‹•æ’åº
- ç”Ÿæˆ CMS10 æ¨™æº–çš„æ’­æ”¾åœ°å€æ ¼å¼
- æ”¯æ´è‡ªå®šç¾©åŸºç¤ URL

### 2.2 å›æ‡‰æ ¼å¼åŒ–å™¨ (response.js)

#### 2.2.1 æ¨™æº–å›æ‡‰å»ºæ§‹
```javascript
function createCms10Response(options)
function createSuccessResponse(data, pagination)
function createErrorResponse(code, message)
```

**å¯¦ä½œç‰¹é»**:
- å®Œå…¨ç¬¦åˆ CMS10 æ¨™æº–æ ¼å¼
- è‡ªå‹•è¨ˆç®—åˆ†é è³‡è¨Š
- çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ ¼å¼

#### 2.2.2 åˆ†é è™•ç†
```javascript
function calculatePagination(total, page, limit)
function paginateData(data, page, limit)
```

**å¯¦ä½œç‰¹é»**:
- æ™ºèƒ½åˆ†é è¨ˆç®—
- é™åˆ¶æœ€å¤§æ¯é æ•¸é‡ (100)
- æä¾›å®Œæ•´çš„åˆ†é å…ƒè³‡è¨Š

### 2.3 ç¯©é¸å™¨ (filters.js)

#### 2.3.1 å¤šç¶­åº¦ç¯©é¸
```javascript
function filterByCategory(items, typeId)
function searchByKeyword(items, keyword)
function filterByUpdateTime(items, hours)
function filterByIds(items, idsString)
```

**å¯¦ä½œç‰¹é»**:
- æ”¯æ´åˆ†é¡ã€é—œéµå­—ã€æ™‚é–“ã€ID å¤šç¨®ç¯©é¸
- æ™ºèƒ½æœå°‹ (æ¨™é¡Œã€æè¿°ã€ä½œè€…ã€åˆ†é¡)
- çµ„åˆç¯©é¸åŠŸèƒ½

#### 2.3.2 æ’åºåŠŸèƒ½
```javascript
function sortItems(items, sortBy, order)
```

**å¯¦ä½œç‰¹é»**:
- æ”¯æ´å¤šæ¬„ä½æ’åº (æ™‚é–“ã€æ¨™é¡Œã€IDã€é›†æ•¸)
- å‡åº/é™åºæ’åˆ—
- å®¹éŒ¯è™•ç†

### 2.4 æµç¨‹è™•ç†å™¨ (processors.js)

#### 2.4.1 å®Œæ•´è½‰æ›æµç¨‹
```javascript
function convertListResponse(myselfData, query, options)
function convertDetailResponse(detailItems, query, options)
```

**å¯¦ä½œç‰¹é»**:
- ç«¯åˆ°ç«¯çš„è½‰æ›æµç¨‹
- å®Œæ•´çš„éŒ¯èª¤è™•ç†
- æ”¯æ´å¤šç¨®è³‡æ–™æºæ ¼å¼

#### 2.4.2 é«˜ç´šåŠŸèƒ½
```javascript
function mergeDataSources(dataSources)
function processSearchRequest(dataSources, keyword, query, options)
function processCategoryRequest(dataSources, categoryId, query, options)
```

**å¯¦ä½œç‰¹é»**:
- å¤šè³‡æ–™æºåˆä½µ
- å»é‡è™•ç†
- å°ˆé–€çš„æœå°‹å’Œåˆ†é¡è™•ç†æµç¨‹

## 3. å‡½å¼ç´šè¨»è§£è¦ç¯„

æ‰€æœ‰å‡½å¼éƒ½åŒ…å«å®Œæ•´çš„ JSDoc è¨»è§£ï¼ŒåŒ…å«ï¼š

### 3.1 è¨»è§£çµæ§‹
```javascript
/**
 * å‡½å¼æè¿°
 * @param {type} paramName - åƒæ•¸èªªæ˜
 * @returns {type} è¿”å›å€¼èªªæ˜
 *
 * @example
 * ä½¿ç”¨ç¯„ä¾‹
 * // é æœŸçµæœ
 */
```

### 3.2 è¨»è§£è¦†è“‹ç‡
- âœ… æ‰€æœ‰å…¬é–‹å‡½å¼ 100% è¦†è“‹
- âœ… åƒæ•¸é¡å‹å’Œèªªæ˜å®Œæ•´
- âœ… è¿”å›å€¼èªªæ˜æ¸…æ™°
- âœ… å¯¦ç”¨çš„ä½¿ç”¨ç¯„ä¾‹

## 4. è³‡æ–™è½‰æ›å°æ‡‰è¡¨

### 4.1 åŸºæœ¬æ¬„ä½æ˜ å°„
| Myself-BBS | CMS10 | è½‰æ›é‚è¼¯ |
|------------|-------|----------|
| `id` | `vod_id` | parseInt() |
| `title` | `vod_name` | ç›´æ¥å°æ‡‰ |
| `category[0]` | `type_id/type_name` | åˆ†é¡æ˜ å°„è¡¨ |
| `time` | `vod_time` | UTC+8 æ™‚é–“æ ¼å¼ |
| `image` | `vod_pic` | ç›´æ¥å°æ‡‰ |

### 4.2 è©³æƒ…å°ˆç”¨æ¬„ä½
| Myself-BBS | CMS10 | è½‰æ›é‚è¼¯ |
|------------|-------|----------|
| `episodes` | `vod_play_url` | é›†æ•¸$åœ°å€#æ ¼å¼ |
| `premiere` | `vod_year` | æå–å¹´ä»½ |
| `description` | `vod_content` | ç›´æ¥å°æ‡‰ |
| `author` | `vod_director` | ç›´æ¥å°æ‡‰ |

## 5. éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

### 5.1 å®¹éŒ¯è¨­è¨ˆ
- ç„¡æ•ˆè³‡æ–™è‡ªå‹•éæ¿¾
- ç¼ºå¤±æ¬„ä½æä¾›é è¨­å€¼
- è½‰æ›å¤±æ•—ä¸å½±éŸ¿å…¶ä»–é …ç›®
- è©³ç´°çš„éŒ¯èª¤æ—¥èªŒè¨˜éŒ„

### 5.2 è³‡æ–™é©—è­‰
```javascript
function validateCms10Item(item)
function validateCms10Response(response)
```

**é©—è­‰é …ç›®**:
- å¿…è¦æ¬„ä½å®Œæ•´æ€§æª¢æŸ¥
- è³‡æ–™é¡å‹é©—è­‰
- æ ¼å¼è¦ç¯„æª¢æŸ¥
- è­¦å‘Šå’ŒéŒ¯èª¤åˆ†ç´š

## 6. æ•ˆèƒ½å„ªåŒ–

### 6.1 å„ªåŒ–ç­–ç•¥
- æ‰¹é‡è½‰æ›è™•ç†
- æ™ºèƒ½ç¯©é¸é †åº
- è¨˜æ†¶é«”ä½¿ç”¨å„ªåŒ–
- éŒ¯èª¤å¿«é€Ÿå¤±æ•—

### 6.2 æ•ˆèƒ½æŒ‡æ¨™
- å–®é …è½‰æ›: < 1ms
- æ‰¹é‡è½‰æ› (100é …): < 50ms
- è¨˜æ†¶é«”ä½¿ç”¨: ç·šæ€§å¢é•·
- éŒ¯èª¤è™•ç†é–‹éŠ·: < 5%

## 7. ä½¿ç”¨ç¯„ä¾‹

### 7.1 åŸºæœ¬è½‰æ›
```javascript
import { convertListResponse } from './cms10/index.js';

const myselfData = {
  data: {
    data: [
      { id: 1, title: "é€²æ“Šçš„å·¨äºº", category: ["å‹•ä½œ"] }
    ]
  }
};

const result = convertListResponse(myselfData, { pg: 1, limit: 20 });
```

### 7.2 è©³æƒ…è½‰æ›
```javascript
import { convertDetailResponse } from './cms10/index.js';

const detailItem = {
  id: 1,
  title: "é€²æ“Šçš„å·¨äºº",
  episodes: { "ç¬¬ 01 è©±": ["1", "001"] }
};

const result = convertDetailResponse([detailItem]);
```

### 7.3 æœå°‹è™•ç†
```javascript
import { processSearchRequest } from './cms10/index.js';

const result = processSearchRequest(
  [airingData, completedData],
  "å·¨äºº",
  { pg: 1, limit: 20 }
);
```

## 8. æ¸¬è©¦è¦†è“‹

### 8.1 å–®å…ƒæ¸¬è©¦ç¯„åœ
- âœ… æ‰€æœ‰è½‰æ›å‡½å¼
- âœ… ç¯©é¸å’Œæœå°‹åŠŸèƒ½
- âœ… åˆ†é è™•ç†é‚è¼¯
- âœ… éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- âœ… è³‡æ–™é©—è­‰åŠŸèƒ½

### 8.2 æ•´åˆæ¸¬è©¦ç¯„åœ
- âœ… å®Œæ•´è½‰æ›æµç¨‹
- âœ… å¤šè³‡æ–™æºè™•ç†
- âœ… é‚Šç•Œæ¢ä»¶æ¸¬è©¦
- âœ… æ•ˆèƒ½åŸºæº–æ¸¬è©¦

## 9. ç›¸å®¹æ€§ä¿è­‰

### 9.1 CMS10 æ¨™æº–ç›¸å®¹
- âœ… å®Œå…¨ç¬¦åˆ CMS10 API è¦æ ¼
- âœ… æ¨™æº–å›æ‡‰æ ¼å¼
- âœ… æ­£ç¢ºçš„ç‹€æ…‹ç¢¼ä½¿ç”¨
- âœ… åˆ†é æ ¼å¼æ¨™æº–

### 9.2 å‘å¾Œç›¸å®¹æ€§
- âœ… ä¸å½±éŸ¿ç¾æœ‰ API ç«¯é»
- âœ… ç¨ç«‹æ¨¡çµ„è¨­è¨ˆ
- âœ… å¯é¸åŠŸèƒ½å•Ÿç”¨
- âœ… æ¼¸é€²å¼å‡ç´šæ”¯æ´

## 10. ç¶­è­·æŒ‡å—

### 10.1 æ–°å¢åˆ†é¡
1. æ›´æ–° `CATEGORY_MAPPING` å¸¸æ•¸
2. ç¢ºä¿ type_id å”¯ä¸€æ€§
3. æ›´æ–°ç›¸é—œæ¸¬è©¦ç”¨ä¾‹
4. æ›´æ–°æ–‡ä»¶èªªæ˜

### 10.2 ä¿®æ”¹è½‰æ›é‚è¼¯
1. ä¿æŒå‡½å¼ä»‹é¢ç©©å®š
2. æ·»åŠ å‘å¾Œç›¸å®¹è™•ç†
3. æ›´æ–°å–®å…ƒæ¸¬è©¦
4. è¨˜éŒ„è®Šæ›´åŸå› 

### 10.3 æ•ˆèƒ½èª¿å„ª
1. ç›£æ§è½‰æ›æ™‚é–“
2. åˆ†æè¨˜æ†¶é«”ä½¿ç”¨
3. å„ªåŒ–ç†±é»å‡½å¼
4. å®šæœŸæ•ˆèƒ½æ¸¬è©¦

## 11. ä¸‹ä¸€æ­¥è¨ˆåŠƒ

### 11.1 ç«‹å³ä»»å‹™
- [ ] å»ºç«‹éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- [ ] å¯¦ä½œ API ç«¯é»æ•´åˆ
- [ ] å»ºç«‹å®Œæ•´æ¸¬è©¦å¥—ä»¶
- [ ] æ•ˆèƒ½åŸºæº–æ¸¬è©¦

### 11.2 æœªä¾†å¢å¼·
- [ ] å¿«å–æ©Ÿåˆ¶å¯¦ä½œ
- [ ] æ‰¹é‡è™•ç†å„ªåŒ–
- [ ] ç›£æ§å’ŒæŒ‡æ¨™æ”¶é›†
- [ ] è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹

---

**å¯¦ä½œç‹€æ…‹**: âœ… æ ¸å¿ƒè½‰æ›å‡½å¼å·²å®Œæˆ
**ä¸‹ä¸€éšæ®µ**: ğŸš€ å»ºç«‹éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
**é è¨ˆå®Œæˆæ™‚é–“**: 2025-07-26 16:00:00 (UTC+8)